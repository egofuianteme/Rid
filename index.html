<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Gest√£o de RIDs</title>
  <script src="/_sdk/element_sdk.js"></script><!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, where, orderBy, onSnapshot } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyB6yomHyxKUVYCNjDVzK_ruFO8RYMZvl_k",
      authDomain: "sistema-rid-001.firebaseapp.com",
      projectId: "sistema-rid-001",
      storageBucket: "sistema-rid-001.firebasestorage.app",
      messagingSenderId: "875061628205",
      appId: "1:875061628205:web:6b2fa59e90a9846d1157a4"
    };
    
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    
    // Expor fun√ß√µes Firebase globalmente
    window.firebaseDB = {
      db,
      collection,
      addDoc,
      getDocs,
      updateDoc,
      deleteDoc,
      doc,
      query,
      where,
      orderBy,
      onSnapshot
    };
    
    // ============================================
    // FUN√á√ïES FIREBASE - SALVAR E BUSCAR DADOS
    // ============================================
    
    /**
     * Salvar um novo RID no Firestore
     */
    window.salvarRIDFirebase = async (ridData) => {
      try {
        const docRef = await addDoc(collection(db, 'rids'), {
          ...ridData,
          data_criacao: new Date().toISOString(),
          ultimo_update: new Date().toISOString()
        });
        console.log('‚úÖ RID salvo no Firebase com ID:', docRef.id);
        return docRef.id;
      } catch (error) {
        console.error('‚ùå Erro ao salvar RID no Firebase:', error);
        throw error;
      }
    };
    
    /**
     * Salvar funcion√°rio no Firestore
     */
    window.salvarFuncionarioFirebase = async (funcData) => {
      try {
        const docRef = await addDoc(collection(db, 'funcionarios'), {
          ...funcData,
          data_criacao: new Date().toISOString()
        });
        console.log('‚úÖ Funcion√°rio salvo no Firebase com ID:', docRef.id);
        return docRef.id;
      } catch (error) {
        console.error('‚ùå Erro ao salvar funcion√°rio no Firebase:', error);
        throw error;
      }
    };
    
    /**
     * Buscar todos os RIDs do Firestore
     */
    window.buscarRIDsFirebase = async () => {
      try {
        const querySnapshot = await getDocs(collection(db, 'rids'));
        const rids = [];
        querySnapshot.forEach((doc) => {
          rids.push({
            firebaseId: doc.id,
            ...doc.data()
          });
        });
        console.log('üì• RIDs buscados do Firebase:', rids.length);
        return rids;
      } catch (error) {
        console.error('‚ùå Erro ao buscar RIDs do Firebase:', error);
        throw error;
      }
    };
    
    /**
     * Buscar todos os funcion√°rios do Firestore
     */
    window.buscarFuncionariosFirebase = async () => {
      try {
        const querySnapshot = await getDocs(collection(db, 'funcionarios'));
        const funcionarios = [];
        querySnapshot.forEach((doc) => {
          funcionarios.push({
            firebaseId: doc.id,
            ...doc.data()
          });
        });
        console.log('üì• Funcion√°rios buscados do Firebase:', funcionarios.length);
        return funcionarios;
      } catch (error) {
        console.error('‚ùå Erro ao buscar funcion√°rios do Firebase:', error);
        throw error;
      }
    };
    
    /**
     * Atualizar um RID existente
     */
    window.atualizarRIDFirebase = async (ridId, updates) => {
      try {
        const ridRef = doc(db, 'rids', ridId);
        await updateDoc(ridRef, {
          ...updates,
          ultimo_update: new Date().toISOString()
        });
        console.log('‚úÖ RID atualizado no Firebase:', ridId);
      } catch (error) {
        console.error('‚ùå Erro ao atualizar RID no Firebase:', error);
        throw error;
      }
    };
    
    /**
     * Deletar um RID
     */
    window.deletarRIDFirebase = async (ridId) => {
      try {
        await deleteDoc(doc(db, 'rids', ridId));
        console.log('‚úÖ RID deletado do Firebase:', ridId);
      } catch (error) {
        console.error('‚ùå Erro ao deletar RID do Firebase:', error);
        throw error;
      }
    };
    
    /**
     * Deletar um funcion√°rio
     */
    window.deletarFuncionarioFirebase = async (funcId) => {
      try {
        await deleteDoc(doc(db, 'funcionarios', funcId));
        console.log('‚úÖ Funcion√°rio deletado do Firebase:', funcId);
      } catch (error) {
        console.error('‚ùå Erro ao deletar funcion√°rio do Firebase:', error);
        throw error;
      }
    };
    
    /**
     * Listener em tempo real para RIDs
     */
    window.escutarRIDsFirebase = (callback) => {
      const q = query(collection(db, 'rids'), orderBy('data_criacao', 'desc'));
      return onSnapshot(q, (snapshot) => {
        const rids = [];
        snapshot.forEach((doc) => {
          rids.push({
            firebaseId: doc.id,
            ...doc.data()
          });
        });
        callback(rids);
      });
    };
    
    /**
     * Listener em tempo real para funcion√°rios
     */
    window.escutarFuncionariosFirebase = (callback) => {
      const q = query(collection(db, 'funcionarios'), orderBy('data_criacao', 'desc'));
      return onSnapshot(q, (snapshot) => {
        const funcionarios = [];
        snapshot.forEach((doc) => {
          funcionarios.push({
            firebaseId: doc.id,
            ...doc.data()
          });
        });
        callback(funcionarios);
      });
    };
    
    console.log('üî• Firebase inicializado com sucesso!');
    console.log('üì° Sincroniza√ß√£o em tempo real ativada!');
  </script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    * {
      box-sizing: border-box;
    }
    
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    
    #app-root {
      width: 100%;
      height: 100%;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .spinner {
      border: 2px solid rgba(0,0,0,0.1);
      border-left-color: currentColor;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 0.6s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    input:focus, select:focus, textarea:focus, button:focus {
      outline: none;
    }
    
    .scrollable {
      overflow-y: auto;
      scrollbar-width: thin;
    }
    
    .scrollable::-webkit-scrollbar {
      width: 6px;
    }
    
    .scrollable::-webkit-scrollbar-track {
      background: transparent;
    }
    
    .scrollable::-webkit-scrollbar-thumb {
      background: rgba(0,0,0,0.2);
      border-radius: 3px;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div id="app-root"></div>
  <script>
    // ============================================
    // CONFIGURA√á√ÉO EDIT√ÅVEL
    // ============================================
    const defaultConfig = {
      background_color: "#F5F5F5",
      surface_color: "#FFFFFF",
      text_color: "#2c2c2c",
      primary_action_color: "#FFC642",
      secondary_action_color: "#949494",
      
      font_family: "Inter",
      font_size: 15,
      
      titulo_sistema: "Sistema de Gest√£o de RIDs",
      texto_login: "Acesse sua conta",
      usuario_admin: "admin",
      senha_admin: "admin123"
    };
    
    // ============================================
    // ESTADO GLOBAL
    // ============================================
    let currentData = [];
    let currentFuncionarios = [];
    let currentUser = null;
    let currentAdminSection = 'dashboard';
    let isSaving = false;
    let ridsListener = null;
    let funcionariosListener = null;
    
    // ============================================
    // HELPERS
    // ============================================
    function $(id) {
      return document.getElementById(id);
    }
    
    function showMessage(msg, type = 'info') {
      const container = $('message-container');
      if (!container) return;
      
      const div = document.createElement('div');
      div.className = `message-toast ${type}`;
      div.textContent = msg;
      div.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        z-index: 10000;
        animation: slideIn 0.3s ease-out;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      `;
      
      if (type === 'error') {
        div.style.background = '#ff4444';
        div.style.color = '#fff';
      } else if (type === 'success') {
        div.style.background = '#22c55e';
        div.style.color = '#fff';
      } else {
        div.style.background = '#e4a40d';
        div.style.color = '#fff';
      }
      
      container.appendChild(div);
      
      setTimeout(() => {
        div.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => div.remove(), 300);
      }, 3000);
    }
    
    // ============================================
    // √çCONES SVG
    // ============================================
    const icons = {
      user: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>`,
      lock: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>`,
      dashboard: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>`,
      file: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>`,
      users: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>`,
      chart: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>`,
      logout: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>`,
      plus: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>`,
      trash: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>`,
      edit: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>`,
      check: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>`,
      x: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`
    };
    
    // ============================================
    // SINCRONIZA√á√ÉO FIREBASE EM TEMPO REAL
    // ============================================
    function iniciarSincronizacaoFirebase() {
      if (!window.escutarRIDsFirebase || !window.escutarFuncionariosFirebase) {
        console.log('‚è≥ Aguardando Firebase...');
        setTimeout(iniciarSincronizacaoFirebase, 500);
        return;
      }
      
      console.log('üî• Iniciando sincroniza√ß√£o em tempo real...');
      
      // Listener para RIDs
      ridsListener = window.escutarRIDsFirebase((rids) => {
        console.log('üì° RIDs atualizados:', rids.length);
        currentData = rids;
        
        // Atualizar interface
        if (currentUser) {
          if (currentUser.tipo === 'admin') {
            if (currentAdminSection === 'dashboard') {
              const dashContent = $('admin-content');
              if (dashContent) renderDashboard(dashContent);
            } else if (currentAdminSection === 'rids') {
              renderRidsList();
            }
          } else {
            renderFuncRidsList();
          }
        }
      });
      
      // Listener para funcion√°rios
      funcionariosListener = window.escutarFuncionariosFirebase((funcionarios) => {
        console.log('üì° Funcion√°rios atualizados:', funcionarios.length);
        currentFuncionarios = funcionarios;
        
        // Atualizar interface
        if (currentUser && currentUser.tipo === 'admin' && currentAdminSection === 'funcionarios') {
          renderFuncionariosList();
        }
      });
      
      showMessage('Sincroniza√ß√£o em tempo real ativada!', 'success');
    }
    
    // ============================================
    // RENDER PRINCIPAL
    // ============================================
    function render() {
      const root = $('app-root');
      if (!root) return;
      
      root.innerHTML = `
        <div id="message-container"></div>
        <div id="app-container" style="width: 100%; height: 100%;"></div>
      `;
      
      if (!currentUser) {
        renderLogin();
      } else if (currentUser.tipo === 'admin') {
        renderAdminPanel();
      } else {
        renderFuncionarioPanel();
      }
    }
    
    // ============================================
    // TELA DE LOGIN
    // ============================================
    let showCadastro = false;
    
    function renderLogin() {
      const container = $('app-container');
      const config = window.elementSdk?.config || defaultConfig;
      
      container.innerHTML = `
        <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: ${config.background_color || defaultConfig.background_color};">
          <div class="fade-in" style="width: 100%; max-width: 400px; padding: 20px;">
            <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 16px; padding: 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
              <div style="text-align: center; margin-bottom: 32px;">
                <h1 id="login-title" style="margin: 0 0 8px 0; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};"></h1>
                <p id="login-subtitle" style="margin: 0; opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};"></p>
              </div>
              
              <!-- Formul√°rio de Login -->
              <form id="login-form" style="display: ${!showCadastro ? 'flex' : 'none'}; flex-direction: column; gap: 20px;">
                <div>
                  <label for="login-usuario" style="display: block; margin-bottom: 8px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">Usu√°rio</label>
                  <div style="position: relative;">
                    <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; color: ${config.text_color || defaultConfig.text_color};">${icons.user}</span>
                    <input 
                      id="login-usuario" 
                      type="text" 
                      placeholder="Digite seu usu√°rio"
                      style="width: 100%; padding: 12px 12px 12px 42px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};"
                      required
                    />
                  </div>
                </div>
                
                <div>
                  <label for="login-senha" style="display: block; margin-bottom: 8px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">Senha</label>
                  <div style="position: relative;">
                    <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; color: ${config.text_color || defaultConfig.text_color};">${icons.lock}</span>
                    <input 
                      id="login-senha" 
                      type="password" 
                      placeholder="Digite sua senha"
                      style="width: 100%; padding: 12px 12px 12px 42px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};"
                      required
                    />
                  </div>
                </div>
                
                <button 
                  id="btn-login" 
                  type="submit"
                  style="width: 100%; padding: 14px; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: #fff; transition: opacity 0.2s;"
                  onmouseover="this.style.opacity='0.9'"
                  onmouseout="this.style.opacity='1'"
                >
                  Entrar
                </button>
              </form>
              
              <!-- Bot√µes de Navega√ß√£o -->
              <div style="display: ${!showCadastro ? 'block' : 'none'};">
                <button 
                  id="btn-ir-cadastro" 
                  style="width: 100%; padding: 14px; margin-top: 12px; border: 2px solid ${config.primary_action_color || defaultConfig.primary_action_color}; background: transparent; color: ${config.primary_action_color || defaultConfig.primary_action_color}; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s;"
                  onmouseover="this.style.background='${config.primary_action_color || defaultConfig.primary_action_color}10'"
                  onmouseout="this.style.background='transparent'"
                >
                  Cadastre-se
                </button>
              </div>
              
              <!-- Formul√°rio de Cadastro -->
              <form id="cadastro-form" style="display: ${showCadastro ? 'flex' : 'none'}; flex-direction: column; gap: 20px;">
                <div>
                  <label for="cadastro-nome" style="display: block; margin-bottom: 8px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">Nome Completo</label>
                  <div style="position: relative;">
                    <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; color: ${config.text_color || defaultConfig.text_color};">${icons.user}</span>
                    <input 
                      id="cadastro-nome" 
                      type="text" 
                      placeholder="Digite seu nome completo"
                      style="width: 100%; padding: 12px 12px 12px 42px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};"
                      required
                    />
                  </div>
                </div>
                
                <div>
                  <label for="cadastro-cpf" style="display: block; margin-bottom: 8px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">CPF</label>
                  <div style="position: relative;">
                    <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; color: ${config.text_color || defaultConfig.text_color};">${icons.user}</span>
                    <input 
                      id="cadastro-cpf" 
                      type="text" 
                      placeholder="000.000.000-00"
                      maxlength="14"
                      style="width: 100%; padding: 12px 12px 12px 42px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};"
                      required
                    />
                  </div>
                </div>
                
                <div>
                  <label for="cadastro-senha" style="display: block; margin-bottom: 8px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">Senha</label>
                  <div style="position: relative;">
                    <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; color: ${config.text_color || defaultConfig.text_color};">${icons.lock}</span>
                    <input 
                      id="cadastro-senha" 
                      type="password" 
                      placeholder="Crie uma senha"
                      style="width: 100%; padding: 12px 12px 12px 42px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};"
                      required
                    />
                  </div>
                </div>
                
                <div>
                  <label for="cadastro-confirma-senha" style="display: block; margin-bottom: 8px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">Confirmar Senha</label>
                  <div style="position: relative;">
                    <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; color: ${config.text_color || defaultConfig.text_color};">${icons.lock}</span>
                    <input 
                      id="cadastro-confirma-senha" 
                      type="password" 
                      placeholder="Confirme sua senha"
                      style="width: 100%; padding: 12px 12px 12px 42px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};"
                      required
                    />
                  </div>
                </div>
                
                <button 
                  id="btn-cadastro" 
                  type="submit"
                  style="width: 100%; padding: 14px; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: #fff; transition: opacity 0.2s;"
                  onmouseover="this.style.opacity='0.9'"
                  onmouseout="this.style.opacity='1'"
                >
                  <span id="btn-cadastro-text">Criar Conta</span>
                </button>
                
                <button 
                  id="btn-voltar-login" 
                  type="button"
                  style="width: 100%; padding: 14px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; background: transparent; color: ${config.text_color || defaultConfig.text_color}; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s;"
                  onmouseover="this.style.background='${config.background_color || defaultConfig.background_color}'"
                  onmouseout="this.style.background='transparent'"
                >
                  Voltar ao Login
                </button>
              </form>
              
              <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}20; text-align: center;">
                <p style="margin: 0 0 12px 0; font-size: 12px; opacity: 0.6; color: ${config.text_color || defaultConfig.text_color};">Credenciais de demonstra√ß√£o:</p>
                <div style="display: flex; flex-direction: column; gap: 6px; font-size: 12px; color: ${config.text_color || defaultConfig.text_color};">
                  <div><strong>Admin:</strong> <code id="demo-admin-user" style="background: ${config.background_color || defaultConfig.background_color}; padding: 2px 6px; border-radius: 4px;"></code> / <code id="demo-admin-pass" style="background: ${config.background_color || defaultConfig.background_color}; padding: 2px 6px; border-radius: 4px;"></code></div>
                  <div><strong>Funcion√°rio:</strong> cadastre-se com seu CPF</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      applyConfigToLogin(config);
      attachLoginListeners();
    }
    
    function attachLoginListeners() {
      // Bot√£o Ir para Cadastro
      const btnIrCadastro = $('btn-ir-cadastro');
      if (btnIrCadastro) {
        btnIrCadastro.addEventListener('click', () => {
          showCadastro = true;
          renderLogin();
        });
      }
      
      // Bot√£o Voltar ao Login
      const btnVoltarLogin = $('btn-voltar-login');
      if (btnVoltarLogin) {
        btnVoltarLogin.addEventListener('click', () => {
          showCadastro = false;
          renderLogin();
        });
      }
      
      // Formul√°rio de Login
      const loginForm = $('login-form');
      if (loginForm) {
        loginForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          const usuario = $('login-usuario').value.trim();
          const senha = $('login-senha').value.trim();
          const config = window.elementSdk?.config || defaultConfig;
          
          if (!usuario || !senha) {
            showMessage('Preencha usu√°rio e senha', 'error');
            return;
          }
          
          const adminUser = config.usuario_admin || defaultConfig.usuario_admin;
          const adminPass = config.senha_admin || defaultConfig.senha_admin;
          
          if (usuario === adminUser && senha === adminPass) {
            currentUser = { tipo: 'admin', nome: 'Administrador' };
            showMessage('Login realizado com sucesso!', 'success');
            render();
          } else {
            // Verificar se o usu√°rio est√° cadastrado (usando CPF como usu√°rio)
            const cpfLimpo = usuario.replace(/\D/g, '');
            const usuarioCadastrado = currentFuncionarios.find(u => 
              u.cpf === cpfLimpo && 
              u.senha === senha
            );
            
            if (usuarioCadastrado) {
              currentUser = { tipo: 'funcionario', nome: usuarioCadastrado.nome_completo };
              showMessage(`Bem-vindo, ${usuarioCadastrado.nome_completo}!`, 'success');
              render();
            } else {
              showMessage('CPF ou senha incorretos', 'error');
            }
          }
        });
      }
      
      // M√°scara de CPF
      const cpfInput = $('cadastro-cpf');
      if (cpfInput) {
        cpfInput.addEventListener('input', (e) => {
          let value = e.target.value.replace(/\D/g, '');
          if (value.length > 11) value = value.slice(0, 11);
          
          if (value.length > 9) {
            value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{1,2})/, '$1.$2.$3-$4');
          } else if (value.length > 6) {
            value = value.replace(/(\d{3})(\d{3})(\d{1,3})/, '$1.$2.$3');
          } else if (value.length > 3) {
            value = value.replace(/(\d{3})(\d{1,3})/, '$1.$2');
          }
          
          e.target.value = value;
        });
      }
      
      // Formul√°rio de Cadastro
      const cadastroForm = $('cadastro-form');
      if (cadastroForm) {
        cadastroForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          if (!window.salvarFuncionarioFirebase) {
            showMessage('Sistema de dados n√£o dispon√≠vel', 'error');
            return;
          }
          
          const nomeCompleto = $('cadastro-nome').value.trim();
          const cpf = $('cadastro-cpf').value.trim().replace(/\D/g, '');
          const senha = $('cadastro-senha').value.trim();
          const confirmaSenha = $('cadastro-confirma-senha').value.trim();
          
          if (!nomeCompleto || !cpf || !senha || !confirmaSenha) {
            showMessage('Preencha todos os campos', 'error');
            return;
          }
          
          if (cpf.length !== 11) {
            showMessage('CPF deve conter 11 d√≠gitos', 'error');
            return;
          }
          
          if (senha !== confirmaSenha) {
            showMessage('As senhas n√£o coincidem', 'error');
            return;
          }
          
          if (senha.length < 4) {
            showMessage('A senha deve ter pelo menos 4 caracteres', 'error');
            return;
          }
          
          // Verificar se o CPF j√° existe
          const cpfExiste = currentFuncionarios.find(u => u.cpf === cpf);
          
          if (cpfExiste) {
            showMessage('Este CPF j√° est√° cadastrado', 'error');
            return;
          }
          
          const btnCadastro = $('btn-cadastro');
          const btnText = $('btn-cadastro-text');
          if (btnCadastro && btnText) {
            btnCadastro.disabled = true;
            btnText.innerHTML = '<div class="spinner"></div>';
          }
          
          try {
            await window.salvarFuncionarioFirebase({
              nome_completo: nomeCompleto,
              cpf: cpf,
              senha: senha
            });
            
            showMessage('Conta criada com sucesso! Fa√ßa login para continuar.', 'success');
            showCadastro = false;
            renderLogin();
          } catch (error) {
            showMessage('Erro ao criar conta', 'error');
          } finally {
            if (btnCadastro && btnText) {
              btnCadastro.disabled = false;
              btnText.textContent = 'Criar Conta';
            }
          }
        });
      }
    }
    
    // ============================================
    // PAINEL ADMINISTRATIVO
    // ============================================
    function renderAdminPanel() {
      const container = $('app-container');
      const config = window.elementSdk?.config || defaultConfig;
      
      container.innerHTML = `
        <div style="width: 100%; height: 100%; display: flex; flex-direction: column; background: ${config.background_color || defaultConfig.background_color};">
          <!-- Header -->
          <header style="background: ${config.surface_color || defaultConfig.surface_color}; border-bottom: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}30; padding: 16px 32px;">
            <div style="display: flex; align-items: center; justify-content: space-between;">
              <div>
                <h2 id="admin-sidebar-title" style="margin: 0; font-size: 18px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};"></h2>
                <p style="margin: 4px 0 0 0; font-size: 12px; opacity: 0.6; color: ${config.text_color || defaultConfig.text_color};">Painel Administrativo</p>
              </div>
              
              <button id="btn-logout" style="padding: 10px 16px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; background: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color}; transition: background 0.2s;">
                ${icons.logout}
                <span>Sair</span>
              </button>
            </div>
          </header>
          
          <!-- Navigation Bar -->
          <nav style="background: ${config.surface_color || defaultConfig.surface_color}; border-bottom: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}30; padding: 0 32px; display: flex; gap: 4px;">
            <button id="nav-dashboard" class="nav-item" data-section="dashboard" style="padding: 14px 20px; border: none; background: none; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color}; transition: all 0.2s; border-bottom: 3px solid transparent; position: relative;">
              ${icons.dashboard}
              <span>Dashboard</span>
            </button>
            <button id="nav-rids" class="nav-item" data-section="rids" style="padding: 14px 20px; border: none; background: none; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color}; transition: all 0.2s; border-bottom: 3px solid transparent; position: relative;">
              ${icons.file}
              <span>RIDs</span>
            </button>
            <button id="nav-funcionarios" class="nav-item" data-section="funcionarios" style="padding: 14px 20px; border: none; background: none; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color}; transition: all 0.2s; border-bottom: 3px solid transparent; position: relative;">
              ${icons.users}
              <span>Funcion√°rios</span>
            </button>
            <button id="nav-relatorio" class="nav-item" data-section="relatorio" style="padding: 14px 20px; border: none; background: none; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color}; transition: all 0.2s; border-bottom: 3px solid transparent; position: relative;">
              ${icons.chart}
              <span>Relat√≥rios</span>
            </button>
          </nav>
          
          <!-- Main Content -->
          <main style="flex: 1; overflow-y: auto; height: 100%;" class="scrollable">
            <div id="admin-content" style="padding: 32px; max-width: 1200px; margin: 0 auto;"></div>
          </main>
        </div>
      `;
      
      applyConfigToAdminPanel(config);
      attachAdminListeners();
      renderAdminSection();
    }
    
    function attachAdminListeners() {
      const navItems = document.querySelectorAll('.nav-item');
      navItems.forEach(item => {
        item.addEventListener('click', () => {
          currentAdminSection = item.dataset.section;
          renderAdminSection();
          updateActiveNav();
        });
      });
      
      const btnLogout = $('btn-logout');
      if (btnLogout) {
        btnLogout.addEventListener('click', () => {
          currentUser = null;
          currentAdminSection = 'dashboard';
          showMessage('Logout realizado com sucesso', 'info');
          render();
        });
      }
      
      updateActiveNav();
    }
    
    function updateActiveNav() {
      const config = window.elementSdk?.config || defaultConfig;
      const navItems = document.querySelectorAll('.nav-item');
      navItems.forEach(item => {
        if (item.dataset.section === currentAdminSection) {
          item.style.borderBottomColor = config.primary_action_color || defaultConfig.primary_action_color;
          item.style.color = config.primary_action_color || defaultConfig.primary_action_color;
          item.style.background = 'none';
        } else {
          item.style.borderBottomColor = 'transparent';
          item.style.color = config.text_color || defaultConfig.text_color;
          item.style.background = 'none';
        }
      });
    }
    
    function renderAdminSection() {
      const content = $('admin-content');
      if (!content) return;
      
      if (currentAdminSection === 'dashboard') {
        renderDashboard(content);
      } else if (currentAdminSection === 'rids') {
        renderRidsSection(content);
      } else if (currentAdminSection === 'funcionarios') {
        renderFuncionariosSection(content);
      } else if (currentAdminSection === 'relatorio') {
        renderRelatorioSection(content);
      }
    }
    
    // ============================================
    // DASHBOARD
    // ============================================
    function renderDashboard(content) {
      const config = window.elementSdk?.config || defaultConfig;
      
      const total = currentData.length;
      const abertos = currentData.filter(r => r.status === 'Em aberto').length;
      const emAnalise = currentData.filter(r => r.status === 'Vencidos').length;
      const fechados = currentData.filter(r => r.status === 'Corrigidos').length;
      
      content.innerHTML = `
        <div class="fade-in">
          <h1 style="margin: 0 0 8px 0; font-size: 28px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Dashboard</h1>
          <p style="margin: 0 0 32px 0; opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">Vis√£o geral do sistema - Sincronizado em tempo real üî•</p>
          
          <!-- Cards de estat√≠sticas -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 32px;">
            <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                <span style="font-size: 13px; opacity: 0.6; color: ${config.text_color || defaultConfig.text_color};">Total de RIDs</span>
                <span style="color: ${config.primary_action_color || defaultConfig.primary_action_color};">${icons.file}</span>
              </div>
              <div style="font-size: 32px; font-weight: 700; color: ${config.text_color || defaultConfig.text_color};">${total}</div>
            </div>
            
            <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                <span style="font-size: 13px; opacity: 0.6; color: ${config.text_color || defaultConfig.text_color};">Em aberto</span>
                <span style="color: #ff6b6b;">${icons.file}</span>
              </div>
              <div style="font-size: 32px; font-weight: 700; color: ${config.text_color || defaultConfig.text_color};">${abertos}</div>
            </div>
            
            <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                <span style="font-size: 13px; opacity: 0.6; color: ${config.text_color || defaultConfig.text_color};">Vencidos</span>
                <span style="color: ${config.primary_action_color || defaultConfig.primary_action_color};">${icons.file}</span>
              </div>
              <div style="font-size: 32px; font-weight: 700; color: ${config.text_color || defaultConfig.text_color};">${emAnalise}</div>
            </div>
            
            <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                <span style="font-size: 13px; opacity: 0.6; color: ${config.text_color || defaultConfig.text_color};">Corrigidos</span>
                <span style="color: #51cf66;">${icons.check}</span>
              </div>
              <div style="font-size: 32px; font-weight: 700; color: ${config.text_color || defaultConfig.text_color};">${fechados}</div>
            </div>
          </div>
          
          <!-- √öltimos RIDs -->
          <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); margin-bottom: 24px;">
            <h2 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">RIDs Registrados Esta Semana</h2>
            
            <!-- Cabe√ßalho das colunas -->
            <div style="display: grid; grid-template-columns: 80px 2fr 1.5fr 1.2fr 1fr; gap: 16px; padding: 12px 16px; background: ${config.background_color || defaultConfig.background_color}; border-radius: 8px; margin-bottom: 12px;">
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">ID</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Assunto</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Funcion√°rio</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Data</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Status</div>
            </div>
            
            <div id="dashboard-recent-rids" style="max-height: 300px; overflow-y: auto;" class="scrollable"></div>
          </div>
          
          <!-- Top 3 Funcion√°rios do M√™s -->
          <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
            <h2 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Top 3 Funcion√°rios com Mais RIDs</h2>
            
            <!-- Cabe√ßalho das colunas -->
            <div style="display: grid; grid-template-columns: 100px 2fr 1.5fr 1fr 1.5fr; gap: 16px; padding: 12px 16px; background: ${config.background_color || defaultConfig.background_color}; border-radius: 8px; margin-bottom: 12px;">
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Posi√ß√£o</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Funcion√°rio</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Departamento</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Total RIDs</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">√öltima Atualiza√ß√£o</div>
            </div>
            
            <div id="dashboard-top-funcionarios" style="max-height: 300px; overflow-y: auto;" class="scrollable"></div>
          </div>
        </div>
      `;
      
      renderDashboardRecentRids();
      renderDashboardTopFuncionarios();
    }
    
    function renderDashboardTopFuncionarios() {
      const container = $('dashboard-top-funcionarios');
      if (!container) return;
      
      const config = window.elementSdk?.config || defaultConfig;
      
      // Contar RIDs por funcion√°rio e obter √∫ltima atualiza√ß√£o
      const contagemPorFuncionario = {};
      currentData.forEach(r => {
        if (r.nome_funcionario) {
          if (!contagemPorFuncionario[r.nome_funcionario]) {
            contagemPorFuncionario[r.nome_funcionario] = {
              count: 0,
              ultimaAtualizacao: r.ultimo_update || r.data_criacao
            };
          }
          contagemPorFuncionario[r.nome_funcionario].count++;
          
          // Atualizar para a data mais recente
          const dataAtual = new Date(r.ultimo_update || r.data_criacao);
          const dataArmazenada = new Date(contagemPorFuncionario[r.nome_funcionario].ultimaAtualizacao);
          if (dataAtual > dataArmazenada) {
            contagemPorFuncionario[r.nome_funcionario].ultimaAtualizacao = r.ultimo_update || r.data_criacao;
          }
        }
      });
      
      // Converter para array e ordenar
      const ranking = Object.entries(contagemPorFuncionario)
        .map(([nome, data]) => ({ 
          nome, 
          count: data.count,
          ultimaAtualizacao: data.ultimaAtualizacao
        }))
        .sort((a, b) => b.count - a.count)
        .slice(0, 3);
      
      if (ranking.length === 0) {
        container.innerHTML = `<p style="opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">Nenhum RID registrado ainda</p>`;
        return;
      }
      
      const medals = [
        `<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>`,
        `<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#C0C0C0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>`,
        `<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#CD7F32" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>`
      ];
      const departamentos = ['Produ√ß√£o', 'Manuten√ß√£o', 'Qualidade'];
      
      container.innerHTML = ranking.map((func, index) => {
        const dataFormatada = new Date(func.ultimaAtualizacao).toLocaleDateString('pt-BR', { 
          day: '2-digit', 
          month: '2-digit', 
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
        
        const departamento = departamentos[index % departamentos.length];
        
        return `
        <div style="display: grid; grid-template-columns: 100px 2fr 1.5fr 1fr 1.5fr; gap: 16px; padding: 14px 16px; border-bottom: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}20; align-items: center;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <span>${medals[index]}</span>
            <span style="font-size: 13px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">${index + 1}¬∫</span>
          </div>
          <div style="font-size: 13px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">${func.nome}</div>
          <div style="font-size: 13px; color: ${config.text_color || defaultConfig.text_color};">${departamento}</div>
          <div style="font-size: 13px; font-weight: 700; color: ${config.primary_action_color || defaultConfig.primary_action_color};">${func.count}</div>
          <div style="font-size: 13px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">${dataFormatada}</div>
        </div>
      `;
      }).join('');
    }
    
    function renderDashboardRecentRids() {
      const container = $('dashboard-recent-rids');
      if (!container) return;
      
      const config = window.elementSdk?.config || defaultConfig;
      
      // Calcular in√≠cio da semana (domingo)
      const hoje = new Date();
      const diaSemana = hoje.getDay();
      const inicioSemana = new Date(hoje);
      inicioSemana.setDate(hoje.getDate() - diaSemana);
      inicioSemana.setHours(0, 0, 0, 0);
      
      // Filtrar RIDs da semana atual
      const ridsDaSemana = currentData.filter(r => {
        const dataRid = new Date(r.data_criacao);
        return dataRid >= inicioSemana;
      });
      
      const recent = ridsDaSemana.slice().sort((a, b) => 
        new Date(b.data_criacao).getTime() - new Date(a.data_criacao).getTime()
      );
      
      if (recent.length === 0) {
        container.innerHTML = `<p style="opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color}; padding: 20px; text-align: center;">Nenhum RID registrado esta semana</p>`;
        return;
      }
      
      container.innerHTML = recent.map((r, index) => {
        const dataFormatada = new Date(r.data_criacao).toLocaleDateString('pt-BR', { 
          day: '2-digit', 
          month: '2-digit', 
          year: 'numeric' 
        });
        
        return `
        <div style="display: grid; grid-template-columns: 80px 2fr 1.5fr 1.2fr 1fr; gap: 16px; padding: 14px 16px; border-bottom: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}20; align-items: center;">
          <div style="font-size: 13px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">#${String(index + 1).padStart(3, '0')}</div>
          <div style="font-size: 13px; color: ${config.text_color || defaultConfig.text_color}; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${r.titulo || 'Sem t√≠tulo'}</div>
          <div style="font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">${r.nome_funcionario || '-'}</div>
          <div style="font-size: 13px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">${dataFormatada}</div>
          <div>
            <span style="padding: 4px 12px; background: ${getStatusColor(r.status, config)}20; color: ${getStatusColor(r.status, config)}; border-radius: 6px; font-size: 12px; font-weight: 500; white-space: nowrap; display: inline-block;">
              ${r.status}
            </span>
          </div>
        </div>
      `;
      }).join('');
    }
    
    function getStatusColor(status, config) {
      if (status === 'Em aberto') return '#ff6b6b';
      if (status === 'Vencidos') return config.primary_action_color || defaultConfig.primary_action_color;
      return '#51cf66';
    }
    
    function getRiscoColor(risco) {
      if (risco === 'Cr√≠tico') return '#dc2626';
      if (risco === 'Alto') return '#ea580c';
      if (risco === 'M√©dio') return '#f59e0b';
      if (risco === 'Baixo') return '#10b981';
      return '#6b7280';
    }
    
    // ============================================
    // SE√á√ÉO RIDs (SIMPLIFICADA)
    // ============================================
    function renderRidsSection(content) {
      const config = window.elementSdk?.config || defaultConfig;
      
      content.innerHTML = `
        <div class="fade-in">
          <h1 style="margin: 0 0 8px 0; font-size: 28px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Gest√£o de RIDs</h1>
          <p style="margin: 0 0 32px 0; opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">Todos os RIDs sincronizados em tempo real üî•</p>
          
          <div id="rids-list-container"></div>
        </div>
      `;
      
      renderRidsList();
    }
    
    function renderRidsList() {
      const container = $('rids-list-container');
      if (!container) return;
      
      const config = window.elementSdk?.config || defaultConfig;
      
      if (currentData.length === 0) {
        container.innerHTML = `
          <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 60px 40px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
            <p style="margin: 0; opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">Nenhum RID encontrado</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = `
        <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); overflow: hidden;">
          ${currentData.map((r, index) => {
            const dataFormatada = new Date(r.data_criacao).toLocaleDateString('pt-BR', { 
              day: '2-digit', 
              month: '2-digit', 
              year: 'numeric',
              hour: '2-digit',
              minute: '2-digit'
            });
            
            return `
            <div style="padding: 20px; border-bottom: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}20;">
              <div style="display: flex; align-items: start; justify-content: space-between; gap: 16px; margin-bottom: 12px;">
                <div style="flex: 1;">
                  <h3 style="margin: 0 0 8px 0; font-size: 16px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">${r.titulo || 'Sem t√≠tulo'}</h3>
                  <p style="margin: 0; font-size: 13px; opacity: 0.7; line-height: 1.5; color: ${config.text_color || defaultConfig.text_color};">${r.descricao || 'Sem descri√ß√£o'}</p>
                </div>
                <span style="padding: 6px 12px; background: ${getStatusColor(r.status, config)}20; color: ${getStatusColor(r.status, config)}; border-radius: 6px; font-size: 12px; font-weight: 500; white-space: nowrap;">
                  ${r.status}
                </span>
              </div>
              <div style="display: flex; gap: 20px; font-size: 12px; opacity: 0.6; color: ${config.text_color || defaultConfig.text_color};">
                <span><strong>Funcion√°rio:</strong> ${r.nome_funcionario || '-'}</span>
                <span><strong>Data:</strong> ${dataFormatada}</span>
                ${r.classificacao_risco ? `<span><strong>Risco:</strong> <span style="color: ${getRiscoColor(r.classificacao_risco)}; font-weight: 600;">${r.classificacao_risco}</span></span>` : ''}
              </div>
            </div>
          `;
          }).join('')}
        </div>
      `;
    }
    
    // ============================================
    // SE√á√ÉO FUNCION√ÅRIOS
    // ============================================
    function renderFuncionariosSection(content) {
      const config = window.elementSdk?.config || defaultConfig;
      
      content.innerHTML = `
        <div class="fade-in">
          <h1 style="margin: 0 0 8px 0; font-size: 28px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Funcion√°rios</h1>
          <p style="margin: 0 0 32px 0; opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">Lista de funcion√°rios cadastrados - Sincronizado em tempo real üî•</p>
          
          <div id="funcionarios-list-container"></div>
        </div>
      `;
      
      renderFuncionariosList();
    }
    
    function renderFuncionariosList() {
      const container = $('funcionarios-list-container');
      if (!container) return;
      
      const config = window.elementSdk?.config || defaultConfig;
      
      if (currentFuncionarios.length === 0) {
        container.innerHTML = `
          <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 60px 40px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
            <p style="margin: 0; opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">Nenhum funcion√°rio cadastrado ainda</p>
          </div>
        `;
        return;
      }
      
      const departamentos = ['Produ√ß√£o', 'Manuten√ß√£o', 'Qualidade', 'Administra√ß√£o', 'Log√≠stica'];
      
      container.innerHTML = `
        <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); overflow: hidden;">
          ${currentFuncionarios.map((func, index) => {
            const dataFormatada = new Date(func.data_criacao).toLocaleDateString('pt-BR', { 
              day: '2-digit', 
              month: '2-digit', 
              year: 'numeric' 
            });
            
            const cpfFormatado = func.cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
            const departamento = departamentos[index % departamentos.length];
            
            return `
            <div style="padding: 20px; border-bottom: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}20; display: flex; align-items: center; justify-content: space-between;">
              <div style="display: flex; align-items: center; gap: 16px; flex: 1;">
                <div style="width: 48px; height: 48px; border-radius: 50%; background: ${config.primary_action_color || defaultConfig.primary_action_color}20; display: flex; align-items: center; justify-content: center; color: ${config.primary_action_color || defaultConfig.primary_action_color}; flex-shrink: 0;">
                  ${icons.user}
                </div>
                <div style="flex: 1;">
                  <h3 style="margin: 0 0 4px 0; font-size: 15px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">${func.nome_completo}</h3>
                  <div style="display: flex; gap: 16px; font-size: 12px; opacity: 0.6; color: ${config.text_color || defaultConfig.text_color};">
                    <span><strong>CPF:</strong> ${cpfFormatado}</span>
                    <span><strong>Depto:</strong> ${departamento}</span>
                    <span><strong>Cadastro:</strong> ${dataFormatada}</span>
                  </div>
                </div>
              </div>
              <span style="padding: 6px 12px; background: #22c55e20; color: #22c55e; border-radius: 6px; font-size: 11px; font-weight: 600; white-space: nowrap;">
                ATIVO
              </span>
            </div>
          `;
          }).join('')}
        </div>
      `;
    }
    
    // ============================================
    // SE√á√ÉO RELAT√ìRIOS
    // ============================================
    function renderRelatorioSection(content) {
      const config = window.elementSdk?.config || defaultConfig;
      
      content.innerHTML = `
        <div class="fade-in">
          <h1 style="margin: 0 0 8px 0; font-size: 28px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Relat√≥rios</h1>
          <p style="margin: 0 0 32px 0; opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">An√°lises e relat√≥rios do sistema</p>
          
          <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 60px 40px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
            <div style="color: ${config.secondary_action_color || defaultConfig.secondary_action_color}; margin-bottom: 16px;">
              ${icons.chart}
            </div>
            <h2 style="margin: 0 0 8px 0; font-size: 20px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Em Desenvolvimento</h2>
            <p style="margin: 0; opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">Esta se√ß√£o estar√° dispon√≠vel em breve com relat√≥rios detalhados e an√°lises.</p>
          </div>
        </div>
      `;
    }
    
    // ============================================
    // PAINEL FUNCION√ÅRIO
    // ============================================
    function renderFuncionarioPanel() {
      const container = $('app-container');
      const config = window.elementSdk?.config || defaultConfig;
      
      container.innerHTML = `
        <div style="width: 100%; height: 100%; display: flex; flex-direction: column; background: ${config.background_color || defaultConfig.background_color};">
          <!-- Header -->
          <header style="background: ${config.surface_color || defaultConfig.surface_color}; border-bottom: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}30; padding: 20px 32px;">
            <div style="display: flex; align-items: center; justify-content: space-between;">
              <div>
                <h1 id="func-panel-title" style="margin: 0 0 4px 0; font-size: 22px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};"></h1>
                <p style="margin: 0; font-size: 13px; opacity: 0.6; color: ${config.text_color || defaultConfig.text_color};">Bem-vindo, ${currentUser.nome} üî•</p>
              </div>
              <button id="btn-func-logout" style="padding: 10px 16px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; background: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">
                ${icons.logout}
                <span>Sair</span>
              </button>
            </div>
          </header>
          
          <!-- Main Content -->
          <main style="flex: 1; overflow-y: auto; padding: 32px;" class="scrollable">
            <div style="max-width: 1000px; margin: 0 auto;">
              <!-- Bot√£o Novo RID -->
              <div style="margin-bottom: 24px;">
                <button id="btn-abrir-modal-rid" style="padding: 14px 24px; border: none; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: #fff; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: opacity 0.2s;">
                  ${icons.plus}
                  <span>Emitir Novo RID</span>
                </button>
              </div>
              
              <!-- Meus RIDs -->
              <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                <h2 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Meus RIDs</h2>
                <div id="func-rids-list"></div>
              </div>
            </div>
          </main>
          
          <!-- Modal Novo RID -->
          <div id="modal-func-novo-rid" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
            <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 16px; padding: 32px; width: 90%; max-width: 600px; max-height: 90%; overflow-y: auto;" class="scrollable">
              <h2 style="margin: 0 0 24px 0; font-size: 22px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Emiss√£o de RID</h2>
              <form id="form-func-rid" style="display: flex; flex-direction: column; gap: 20px;">
                
                <!-- 1. Emitente -->
                <div>
                  <label for="func-rid-emitente" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">1. Emitente</label>
                  <input id="func-rid-emitente" type="text" required placeholder="Insira o nome do emitente" style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};" />
                </div>
                
                <!-- 2. Tipo de contrato -->
                <div>
                  <label for="func-rid-tipo-contrato" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">2. Tipo de contrato</label>
                  <select id="func-rid-tipo-contrato" required style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};">
                    <option value="">Selecione...</option>
                    <option value="Funcion√°rio">Funcion√°rio</option>
                    <option value="Terceiro Contratado">Terceiro Contratado</option>
                    <option value="Terceiro Eventual">Terceiro Eventual</option>
                    <option value="Visitante">Visitante</option>
                  </select>
                </div>
                
                <!-- 3. Unidade -->
                <div>
                  <label for="func-rid-unidade" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">3. Unidade</label>
                  <input id="func-rid-unidade" type="text" required placeholder="Insira a unidade" style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};" />
                </div>
                
                <!-- 4. Setor do emitente -->
                <div>
                  <label for="func-rid-setor" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">4. Setor do emitente</label>
                  <select id="func-rid-setor" required style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};">
                    <option value="">Selecione...</option>
                    <option value="ADM">ADM</option>
                    <option value="M. MOVEL">M. MOVEL</option>
                    <option value="M. FIXA">M. FIXA</option>
                    <option value="M. EL√âTRICA">M. EL√âTRICA</option>
                    <option value="PRODU√á√ÉO">PRODU√á√ÉO</option>
                    <option value="MINA">MINA</option>
                  </select>
                </div>
                
                <!-- 5. Data -->
                <div>
                  <label for="func-rid-data" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">5. Data</label>
                  <input id="func-rid-data" type="date" required style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};" />
                </div>
                
                <!-- 6. Incidente ou Desvios -->
                <div>
                  <label for="func-rid-incidente" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">6. Incidente ou Desvios</label>
                  <select id="func-rid-incidente" required style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};">
                    <option value="">Selecione...</option>
                    <option value="Condi√ß√£o de Risco">Condi√ß√£o de Risco</option>
                    <option value="Desvio Comportamental">Desvio Comportamental</option>
                    <option value="Dano Material">Dano Material</option>
                    <option value="Quase acidente">Quase acidente</option>
                  </select>
                </div>
                
                <!-- 7. Origem da detec√ß√£o -->
                <div>
                  <label for="func-rid-origem" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">7. Origem da detec√ß√£o</label>
                  <select id="func-rid-origem" required style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};">
                    <option value="">Selecione...</option>
                    <option value="CSL">CSL</option>
                    <option value="Inspe√ß√£o programada">Inspe√ß√£o programada</option>
                    <option value="Inspe√ß√£o n√£o programada">Inspe√ß√£o n√£o programada</option>
                    <option value="Observa√ß√£o Comportamental">Observa√ß√£o Comportamental</option>
                    <option value="Constata√ß√£o espont√¢nea">Constata√ß√£o espont√¢nea</option>
                    <option value="Auditoria">Auditoria</option>
                  </select>
                </div>
                
                <!-- 8. Local da ocorr√™ncia -->
                <div>
                  <label for="func-rid-local" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">8. Local da ocorr√™ncia</label>
                  <input id="func-rid-local" type="text" required placeholder="Insira o local da ocorr√™ncia" style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};" />
                </div>
                
                <!-- 9. Descri√ß√£o da Ocorr√™ncia -->
                <div>
                  <label for="func-rid-descricao" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">9. Descri√ß√£o da Ocorr√™ncia</label>
                  <textarea id="func-rid-descricao" required rows="4" placeholder="Descreva detalhadamente a ocorr√™ncia" style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; resize: vertical; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};"></textarea>
                </div>
                
                <!-- 10. Classifica√ß√£o de risco -->
                <div>
                  <label for="func-rid-risco" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">10. Classifica√ß√£o de risco</label>
                  <div style="font-size: 11px; opacity: 0.7; margin-bottom: 8px; line-height: 1.4; color: ${config.text_color || defaultConfig.text_color};">
                    <strong>Baixo:</strong> Situa√ß√µes com baixo potencial de causar acidente.<br>
                    <strong>M√©dio:</strong> Situa√ß√µes que podem causar acidente leve se n√£o forem corrigidas.<br>
                    <strong>Alto:</strong> Situa√ß√µes com alto potencial de causar acidente grave ou incapacitante.<br>
                    <strong>Cr√≠tico:</strong> Situa√ß√µes com risco iminente de acidente grave ou fatal.
                  </div>
                  <select id="func-rid-risco" required style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};">
                    <option value="">Selecione...</option>
                    <option value="Baixo">Baixo</option>
                    <option value="M√©dio">M√©dio</option>
                    <option value="Alto">Alto</option>
                    <option value="Cr√≠tico">Cr√≠tico</option>
                  </select>
                </div>
                
                <!-- 11. A√ß√£o Imediata -->
                <div>
                  <label for="func-rid-acao" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">11. A√ß√£o Imediata</label>
                  <textarea id="func-rid-acao" required rows="3" placeholder="Descreva a a√ß√£o imediata tomada" style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; resize: vertical; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};"></textarea>
                </div>
                
                <!-- 12. Status -->
                <div>
                  <label for="func-rid-status" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">12. Status</label>
                  <div style="font-size: 11px; opacity: 0.7; margin-bottom: 8px; line-height: 1.4; color: ${config.text_color || defaultConfig.text_color};">
                    <strong>Corrigido:</strong> RID que j√° foi resolvido.<br>
                    <strong>Vencido:</strong> RID pendente que vai ser passado para um encarregado resolver.
                  </div>
                  <select id="func-rid-status" required style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};">
                    <option value="">Selecione...</option>
                    <option value="Corrigidos">CORRIGIDO</option>
                    <option value="Vencidos">VENCIDO</option>
                  </select>
                </div>
                
                <div style="display: flex; gap: 12px; margin-top: 8px;">
                  <button type="button" id="btn-cancelar-func-rid" style="flex: 1; padding: 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; background: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; color: ${config.text_color || defaultConfig.text_color};">
                    Cancelar
                  </button>
                  <button type="submit" id="btn-func-salvar-rid" style="flex: 1; padding: 12px; border: none; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: #fff; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">
                    <span id="btn-func-salvar-text">Registrar RID</span>
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      `;
      
      applyConfigToFuncPanel(config);
      attachFuncListeners();
      renderFuncRidsList();
    }
    
    function attachFuncListeners() {
      const btnLogout = $('btn-func-logout');
      if (btnLogout) {
        btnLogout.addEventListener('click', () => {
          currentUser = null;
          showMessage('Logout realizado com sucesso', 'info');
          render();
        });
      }
      
      const btnAbrirModal = $('btn-abrir-modal-rid');
      const modal = $('modal-func-novo-rid');
      const btnCancelar = $('btn-cancelar-func-rid');
      const form = $('form-func-rid');
      
      if (btnAbrirModal && modal) {
        btnAbrirModal.addEventListener('click', () => {
          modal.style.display = 'flex';
        });
      }
      
      if (btnCancelar && modal && form) {
        btnCancelar.addEventListener('click', () => {
          modal.style.display = 'none';
          form.reset();
        });
      }
      
      if (modal) {
        modal.addEventListener('click', (e) => {
          if (e.target === modal && form) {
            modal.style.display = 'none';
            form.reset();
          }
        });
      }
      
      if (form) {
        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          if (!window.salvarRIDFirebase) {
            showMessage('Sistema de dados n√£o dispon√≠vel', 'error');
            return;
          }
          
          const emitente = $('func-rid-emitente').value.trim();
          const tipoContrato = $('func-rid-tipo-contrato').value;
          const unidade = $('func-rid-unidade').value.trim();
          const setor = $('func-rid-setor').value;
          const data = $('func-rid-data').value;
          const incidente = $('func-rid-incidente').value;
          const origem = $('func-rid-origem').value;
          const local = $('func-rid-local').value.trim();
          const descricao = $('func-rid-descricao').value.trim();
          const risco = $('func-rid-risco').value;
          const acao = $('func-rid-acao').value.trim();
          const status = $('func-rid-status').value;
          
          if (!emitente || !tipoContrato || !unidade || !setor || !data || !incidente || !origem || !local || !descricao || !risco || !acao || !status) {
            showMessage('Preencha todos os campos obrigat√≥rios', 'error');
            return;
          }
          
          const btnSalvar = $('btn-func-salvar-rid');
          const btnText = $('btn-func-salvar-text');
          if (btnSalvar && btnText) {
            btnSalvar.disabled = true;
            btnText.innerHTML = '<div class="spinner"></div>';
          }
          
          try {
            await window.salvarRIDFirebase({
              nome_funcionario: currentUser.nome,
              emitente: emitente,
              tipo_contrato: tipoContrato,
              unidade: unidade,
              setor: setor,
              data_ocorrencia: data,
              incidente: incidente,
              origem_deteccao: origem,
              local_ocorrencia: local,
              titulo: `${incidente} - ${local}`,
              descricao: descricao,
              classificacao_risco: risco,
              acao_imediata: acao,
              status: status
            });
            
            showMessage('RID registrado com sucesso! Sincronizado na nuvem üî•', 'success');
            if (modal) modal.style.display = 'none';
            form.reset();
          } catch (error) {
            showMessage('Erro ao registrar RID', 'error');
          } finally {
            if (btnSalvar && btnText) {
              btnSalvar.disabled = false;
              btnText.textContent = 'Registrar RID';
            }
          }
        });
      }
    }
    
    function renderFuncRidsList() {
      const container = $('func-rids-list');
      if (!container) return;
      
      const config = window.elementSdk?.config || defaultConfig;
      
      // Filtrar apenas RIDs do funcion√°rio logado
      const meusRids = currentData
        .filter(r => r.nome_funcionario === currentUser.nome)
        .sort((a, b) => new Date(b.data_criacao).getTime() - new Date(a.data_criacao).getTime());
      
      if (meusRids.length === 0) {
        container.innerHTML = `
          <div style="padding: 40px; text-align: center;">
            <p style="margin: 0; opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">Voc√™ ainda n√£o possui RIDs registrados</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = meusRids.map(r => `
        <div style="padding: 16px; border-bottom: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}20;">
          <div style="display: flex; align-items: start; justify-content: space-between; gap: 16px;">
            <div style="flex: 1;">
              <h3 style="margin: 0 0 8px 0; font-size: 15px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">${r.titulo}</h3>
              <p style="margin: 0 0 12px 0; font-size: 13px; opacity: 0.7; line-height: 1.5; color: ${config.text_color || defaultConfig.text_color};">${r.descricao}</p>
              <div style="font-size: 12px; opacity: 0.6; color: ${config.text_color || defaultConfig.text_color};">
                Criado em: ${new Date(r.data_criacao).toLocaleDateString()} ${new Date(r.data_criacao).toLocaleTimeString()}
              </div>
            </div>
            <span style="padding: 6px 12px; background: ${getStatusColor(r.status, config)}20; color: ${getStatusColor(r.status, config)}; border-radius: 6px; font-size: 12px; font-weight: 500; white-space: nowrap;">
              ${r.status}
            </span>
          </div>
        </div>
      `).join('');
    }
    
    // ============================================
    // APLICAR CONFIG (Element SDK)
    // ============================================
    function applyConfigToLogin(config) {
      const cfg = config || defaultConfig;
      
      const title = $('login-title');
      if (title) {
        title.textContent = cfg.titulo_sistema || defaultConfig.titulo_sistema;
        title.style.fontSize = (cfg.font_size || defaultConfig.font_size) * 1.6 + 'px';
        title.style.fontFamily = `${cfg.font_family || defaultConfig.font_family}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;
      }
      
      const subtitle = $('login-subtitle');
      if (subtitle) {
        subtitle.textContent = cfg.texto_login || defaultConfig.texto_login;
        subtitle.style.fontSize = (cfg.font_size || defaultConfig.font_size) * 0.93 + 'px';
      }
      
      const demoUser = $('demo-admin-user');
      const demoPass = $('demo-admin-pass');
      if (demoUser) demoUser.textContent = cfg.usuario_admin || defaultConfig.usuario_admin;
      if (demoPass) demoPass.textContent = cfg.senha_admin || defaultConfig.senha_admin;
    }
    
    function applyConfigToAdminPanel(config) {
      const cfg = config || defaultConfig;
      
      const sidebarTitle = $('admin-sidebar-title');
      if (sidebarTitle) {
        sidebarTitle.textContent = cfg.titulo_sistema || defaultConfig.titulo_sistema;
        sidebarTitle.style.fontFamily = `${cfg.font_family || defaultConfig.font_family}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;
      }
    }
    
    function applyConfigToFuncPanel(config) {
      const cfg = config || defaultConfig;
      
      const title = $('func-panel-title');
      if (title) {
        title.textContent = cfg.titulo_sistema || defaultConfig.titulo_sistema;
        title.style.fontFamily = `${cfg.font_family || defaultConfig.font_family}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;
      }
    }
    
    async function onConfigChange(config) {
      const cfg = config || defaultConfig;
      
      if (!currentUser) {
        applyConfigToLogin(cfg);
      } else if (currentUser.tipo === 'admin') {
        applyConfigToAdminPanel(cfg);
        renderAdminSection();
      } else {
        applyConfigToFuncPanel(cfg);
        renderFuncRidsList();
      }
    }
    
    // ============================================
    // ELEMENT SDK
    // ============================================
    function initElementSdk() {
      if (!window.elementSdk) {
        render();
        iniciarSincronizacaoFirebase();
        return;
      }
      
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => {
          const cfg = config || defaultConfig;
          return {
            recolorables: [
              {
                get: () => cfg.background_color || defaultConfig.background_color,
                set: (value) => {
                  window.elementSdk.setConfig({ background_color: value });
                }
              },
              {
                get: () => cfg.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  window.elementSdk.setConfig({ surface_color: value });
                }
              },
              {
                get: () => cfg.text_color || defaultConfig.text_color,
                set: (value) => {
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => cfg.primary_action_color || defaultConfig.primary_action_color,
                set: (value) => {
                  window.elementSdk.setConfig({ primary_action_color: value });
                }
              },
              {
                get: () => cfg.secondary_action_color || defaultConfig.secondary_action_color,
                set: (value) => {
                  window.elementSdk.setConfig({ secondary_action_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => cfg.font_family || defaultConfig.font_family,
              set: (value) => {
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => cfg.font_size || defaultConfig.font_size,
              set: (value) => {
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          };
        },
        mapToEditPanelValues: (config) => {
          const cfg = config || defaultConfig;
          return new Map([
            ['titulo_sistema', cfg.titulo_sistema || defaultConfig.titulo_sistema],
            ['texto_login', cfg.texto_login || defaultConfig.texto_login],
            ['usuario_admin', cfg.usuario_admin || defaultConfig.usuario_admin],
            ['senha_admin', cfg.senha_admin || defaultConfig.senha_admin]
          ]);
        }
      });
      
      render();
      iniciarSincronizacaoFirebase();
    }
    
    // ============================================
    // BOOTSTRAP
    // ============================================
    initElementSdk();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a458b2be3f5f1dd',t:'MTc2NDExOTgyMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>