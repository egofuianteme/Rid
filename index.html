<!doctype html>
<html lang="pt-BR">
 <head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Sistema de Gestão de RIDs</title>
  <script src="/_sdk/element_sdk.js"></script>
  <script src="/_sdk/data_sdk.js"></script><!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
    import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, where, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';
    
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyB6yomHyxKUVYCNjDVzK_ruFO8RYMZvl_k",
      authDomain: "sistema-rid-001.firebaseapp.com",
      projectId: "sistema-rid-001",
      storageBucket: "sistema-rid-001.firebasestorage.app",
      messagingSenderId: "875061628205",
      appId: "1:875061628205:web:6b2fa59e90a9846d1157a4"
    };
    
    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    
    // Expor funções Firebase globalmente
    window.firebaseDB = {
      db,
      collection,
      addDoc,
      getDocs,
      updateDoc,
      deleteDoc,
      doc,
      query,
      where,
      orderBy
    };
    
    // ============================================
    // FUNÇ��ES FIREBASE - SALVAR E BUSCAR DADOS
    // ============================================
    
    /**
     * Salvar um novo RID no Firestore
     * @param {Object} ridData - Dados do RID { nome_funcionario, titulo, descricao, status }
     * @returns {Promise<string>} - ID do documento criado
     */
    window.salvarRIDFirebase = async (ridData) => {
      try {
        const docRef = await addDoc(collection(db, 'rids'), {
          ...ridData,
          data_criacao: new Date().toISOString(),
          ultimo_update: new Date().toISOString()
        });
        console.log('RID salvo no Firebase com ID:', docRef.id);
        return docRef.id;
      } catch (error) {
        console.error('Erro ao salvar RID no Firebase:', error);
        throw error;
      }
    };
    
    /**
     * Buscar todos os RIDs do Firestore
     * @returns {Promise<Array>} - Array de RIDs
     */
    window.buscarRIDsFirebase = async () => {
      try {
        const querySnapshot = await getDocs(collection(db, 'rids'));
        const rids = [];
        querySnapshot.forEach((doc) => {
          rids.push({
            id: doc.id,
            ...doc.data()
          });
        });
        console.log('RIDs buscados do Firebase:', rids.length);
        return rids;
      } catch (error) {
        console.error('Erro ao buscar RIDs do Firebase:', error);
        throw error;
      }
    };
    
    /**
     * Buscar RIDs por funcionário
     * @param {string} nomeFuncionario - Nome do funcionário
     * @returns {Promise<Array>} - Array de RIDs do funcionário
     */
    window.buscarRIDsPorFuncionarioFirebase = async (nomeFuncionario) => {
      try {
        const q = query(
          collection(db, 'rids'),
          where('nome_funcionario', '==', nomeFuncionario),
          orderBy('data_criacao', 'desc')
        );
        const querySnapshot = await getDocs(q);
        const rids = [];
        querySnapshot.forEach((doc) => {
          rids.push({
            id: doc.id,
            ...doc.data()
          });
        });
        console.log('RIDs do funcionário buscados:', rids.length);
        return rids;
      } catch (error) {
        console.error('Erro ao buscar RIDs por funcionário:', error);
        throw error;
      }
    };
    
    /**
     * Atualizar um RID existente
     * @param {string} ridId - ID do documento
     * @param {Object} updates - Dados a atualizar
     * @returns {Promise<void>}
     */
    window.atualizarRIDFirebase = async (ridId, updates) => {
      try {
        const ridRef = doc(db, 'rids', ridId);
        await updateDoc(ridRef, {
          ...updates,
          ultimo_update: new Date().toISOString()
        });
        console.log('RID atualizado no Firebase:', ridId);
      } catch (error) {
        console.error('Erro ao atualizar RID no Firebase:', error);
        throw error;
      }
    };
    
    /**
     * Deletar um RID
     * @param {string} ridId - ID do documento
     * @returns {Promise<void>}
     */
    window.deletarRIDFirebase = async (ridId) => {
      try {
        await deleteDoc(doc(db, 'rids', ridId));
        console.log('RID deletado do Firebase:', ridId);
      } catch (error) {
        console.error('Erro ao deletar RID do Firebase:', error);
        throw error;
      }
    };
    
    /**
     * Buscar RIDs por status
     * @param {string} status - Status do RID ('Aberto', 'Em análise', 'Fechado')
     * @returns {Promise<Array>} - Array de RIDs com o status especificado
     */
    window.buscarRIDsPorStatusFirebase = async (status) => {
      try {
        const q = query(
          collection(db, 'rids'),
          where('status', '==', status),
          orderBy('data_criacao', 'desc')
        );
        const querySnapshot = await getDocs(q);
        const rids = [];
        querySnapshot.forEach((doc) => {
          rids.push({
            id: doc.id,
            ...doc.data()
          });
        });
        console.log(`RIDs com status '${status}' buscados:`, rids.length);
        return rids;
      } catch (error) {
        console.error('Erro ao buscar RIDs por status:', error);
        throw error;
      }
    };
    
    // ============================================
    // EXEMPLO DE USO DAS FUNÇÕES
    // ============================================
    
    /*
    // Exemplo 1: Salvar um novo RID
    const novoRID = {
      nome_funcionario: 'João Silva',
      titulo: 'Problema na máquina X',
      descricao: 'A máquina apresentou falha no sistema de refrigeração',
      status: 'Aberto'
    };
    const ridId = await window.salvarRIDFirebase(novoRID);
    
    // Exemplo 2: Buscar todos os RIDs
    const todosRIDs = await window.buscarRIDsFirebase();
    
    // Exemplo 3: Buscar RIDs de um funcionário específico
    const ridsJoao = await window.buscarRIDsPorFuncionarioFirebase('João Silva');
    
    // Exemplo 4: Atualizar status de um RID
    await window.atualizarRIDFirebase(ridId, { status: 'Em análise' });
    
    // Exemplo 5: Deletar um RID
    await window.deletarRIDFirebase(ridId);
    
    // Exemplo 6: Buscar RIDs por status
    const ridsAbertos = await window.buscarRIDsPorStatusFirebase('Aberto');
    */
    
    console.log('Firebase inicializado com sucesso!');
    console.log('Funções disponíveis:');
    console.log('- window.salvarRIDFirebase(ridData)');
    console.log('- window.buscarRIDsFirebase()');
    console.log('- window.buscarRIDsPorFuncionarioFirebase(nomeFuncionario)');
    console.log('- window.atualizarRIDFirebase(ridId, updates)');
    console.log('- window.deletarRIDFirebase(ridId)');
    console.log('- window.buscarRIDsPorStatusFirebase(status)');
  </script>
  <style>
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    * {
      box-sizing: border-box;
    }
    
    html, body {
      width: 100%;
      height: 100%;
      overflow: hidden;
    }
    
    #app-root {
      width: 100%;
      height: 100%;
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    }
    
    .fade-in {
      animation: fadeIn 0.3s ease-in;
    }
    
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    
    .spinner {
      border: 2px solid rgba(0,0,0,0.1);
      border-left-color: currentColor;
      border-radius: 50%;
      width: 16px;
      height: 16px;
      animation: spin 0.6s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    input:focus, select:focus, textarea:focus, button:focus {
      outline: none;
    }
    
    .scrollable {
      overflow-y: auto;
      scrollbar-width: thin;
    }
    
    .scrollable::-webkit-scrollbar {
      width: 6px;
    }
    
    .scrollable::-webkit-scrollbar-track {
      background: transparent;
    }
    
    .scrollable::-webkit-scrollbar-thumb {
      background: rgba(0,0,0,0.2);
      border-radius: 3px;
    }
  </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div id="app-root"></div>
  <script>
    // ============================================
    // CONFIGURAÇÃO EDIT����VEL
    // ============================================
    const defaultConfig = {
      background_color: "#F5F5F5",
      surface_color: "#FFFFFF",
      text_color: "#2c2c2c",
      primary_action_color: "#FFC642",
      secondary_action_color: "#949494",
      
      font_family: "Inter",
      font_size: 15,
      
      titulo_sistema: "Sistema de Gestão de RIDs",
      texto_login: "Acesse sua conta",
      usuario_admin: "admin",
      senha_admin: "admin123"
    };
    
    // ============================================
    // ESTADO GLOBAL
    // ============================================
    let currentData = [];
    let currentRecordCount = 0;
    let currentUser = null; // { tipo: 'admin' | 'funcionario', nome: string }
    let currentAdminSection = 'dashboard'; // dashboard | rids | funcionarios | relatorio
    let isSaving = false;
    
    // ============================================
    // HELPERS
    // ============================================
    function $(id) {
      return document.getElementById(id);
    }
    
    function showMessage(msg, type = 'info') {
      const container = $('message-container');
      if (!container) return;
      
      const div = document.createElement('div');
      div.className = `message-toast ${type}`;
      div.textContent = msg;
      div.style.cssText = `
        position: fixed;
        top: 20px;
        right: 20px;
        padding: 12px 20px;
        border-radius: 8px;
        font-size: 14px;
        font-weight: 500;
        z-index: 10000;
        animation: slideIn 0.3s ease-out;
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      `;
      
      if (type === 'error') {
        div.style.background = '#ff4444';
        div.style.color = '#fff';
      } else if (type === 'success') {
        div.style.background = '#22c55e';
        div.style.color = '#fff';
      } else {
        div.style.background = '#e4a40d';
        div.style.color = '#fff';
      }
      
      container.appendChild(div);
      
      setTimeout(() => {
        div.style.animation = 'slideOut 0.3s ease-in';
        setTimeout(() => div.remove(), 300);
      }, 3000);
    }
    
    // ============================================
    // ÍCONES SVG (sem preenchimento)
    // ============================================
    const icons = {
      user: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path><circle cx="12" cy="7" r="4"></circle></svg>`,
      lock: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"></rect><path d="M7 11V7a5 5 0 0 1 10 0v4"></path></svg>`,
      dashboard: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="7" height="7"></rect><rect x="14" y="3" width="7" height="7"></rect><rect x="14" y="14" width="7" height="7"></rect><rect x="3" y="14" width="7" height="7"></rect></svg>`,
      file: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"></path><polyline points="14 2 14 8 20 8"></polyline></svg>`,
      users: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"></path><circle cx="9" cy="7" r="4"></circle><path d="M23 21v-2a4 4 0 0 0-3-3.87"></path><path d="M16 3.13a4 4 0 0 1 0 7.75"></path></svg>`,
      chart: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="20" x2="18" y2="10"></line><line x1="12" y1="20" x2="12" y2="4"></line><line x1="6" y1="20" x2="6" y2="14"></line></svg>`,
      logout: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"></path><polyline points="16 17 21 12 16 7"></polyline><line x1="21" y1="12" x2="9" y2="12"></line></svg>`,
      plus: `<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="12" y1="5" x2="12" y2="19"></line><line x1="5" y1="12" x2="19" y2="12"></line></svg>`,
      trash: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="3 6 5 6 21 6"></polyline><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path></svg>`,
      edit: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path><path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path></svg>`,
      check: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>`,
      x: `<svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>`
    };
    
    // ============================================
    // RENDER PRINCIPAL
    // ============================================
    function render() {
      const root = $('app-root');
      if (!root) return;
      
      root.innerHTML = `
        <div id="message-container"></div>
        <div id="app-container" style="width: 100%; height: 100%;"></div>
      `;
      
      if (!currentUser) {
        renderLogin();
      } else if (currentUser.tipo === 'admin') {
        renderAdminPanel();
      } else {
        renderFuncionarioPanel();
      }
    }
    
    // ============================================
    // TELA DE LOGIN
    // ============================================
    let showCadastro = false;
    
    function renderLogin() {
      const container = $('app-container');
      const config = window.elementSdk?.config || defaultConfig;
      
      container.innerHTML = `
        <div style="width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: ${config.background_color || defaultConfig.background_color};">
          <div class="fade-in" style="width: 100%; max-width: 400px; padding: 20px;">
            <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 16px; padding: 40px; box-shadow: 0 4px 20px rgba(0,0,0,0.08);">
              <div style="text-align: center; margin-bottom: 32px;">
                <h1 id="login-title" style="margin: 0 0 8px 0; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};"></h1>
                <p id="login-subtitle" style="margin: 0; opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};"></p>
              </div>
              

              
              <!-- Formulário de Login -->
              <form id="login-form" style="display: ${!showCadastro ? 'flex' : 'none'}; flex-direction: column; gap: 20px;">
                <div>
                  <label for="login-usuario" style="display: block; margin-bottom: 8px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">Usuário</label>
                  <div style="position: relative;">
                    <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; color: ${config.text_color || defaultConfig.text_color};">${icons.user}</span>
                    <input 
                      id="login-usuario" 
                      type="text" 
                      placeholder="Digite seu usuário"
                      style="width: 100%; padding: 12px 12px 12px 42px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};"
                      required
                    />
                  </div>
                </div>
                
                <div>
                  <label for="login-senha" style="display: block; margin-bottom: 8px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">Senha</label>
                  <div style="position: relative;">
                    <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; color: ${config.text_color || defaultConfig.text_color};">${icons.lock}</span>
                    <input 
                      id="login-senha" 
                      type="password" 
                      placeholder="Digite sua senha"
                      style="width: 100%; padding: 12px 12px 12px 42px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};"
                      required
                    />
                  </div>
                </div>
                
                <button 
                  id="btn-login" 
                  type="submit"
                  style="width: 100%; padding: 14px; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: #fff; transition: opacity 0.2s;"
                  onmouseover="this.style.opacity='0.9'"
                  onmouseout="this.style.opacity='1'"
                >
                  Entrar
                </button>
              </form>
              
              <!-- Botões de Navegação -->
              <div style="display: ${!showCadastro ? 'block' : 'none'};">
                <button 
                  id="btn-ir-cadastro" 
                  style="width: 100%; padding: 14px; margin-top: 12px; border: 2px solid ${config.primary_action_color || defaultConfig.primary_action_color}; background: transparent; color: ${config.primary_action_color || defaultConfig.primary_action_color}; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; transition: all 0.2s;"
                  onmouseover="this.style.background='${config.primary_action_color || defaultConfig.primary_action_color}10'"
                  onmouseout="this.style.background='transparent'"
                >
                  Cadastre-se
                </button>
              </div>
              
              <!-- Formulário de Cadastro -->
              <form id="cadastro-form" style="display: ${showCadastro ? 'flex' : 'none'}; flex-direction: column; gap: 20px;">
                <div>
                  <label for="cadastro-nome" style="display: block; margin-bottom: 8px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">Nome Completo</label>
                  <div style="position: relative;">
                    <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; color: ${config.text_color || defaultConfig.text_color};">${icons.user}</span>
                    <input 
                      id="cadastro-nome" 
                      type="text" 
                      placeholder="Digite seu nome completo"
                      style="width: 100%; padding: 12px 12px 12px 42px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};"
                      required
                    />
                  </div>
                </div>
                
                <div>
                  <label for="cadastro-cpf" style="display: block; margin-bottom: 8px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">CPF</label>
                  <div style="position: relative;">
                    <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; color: ${config.text_color || defaultConfig.text_color};">${icons.user}</span>
                    <input 
                      id="cadastro-cpf" 
                      type="text" 
                      placeholder="000.000.000-00"
                      maxlength="14"
                      style="width: 100%; padding: 12px 12px 12px 42px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};"
                      required
                    />
                  </div>
                </div>
                
                <div>
                  <label for="cadastro-senha" style="display: block; margin-bottom: 8px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">Senha</label>
                  <div style="position: relative;">
                    <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; color: ${config.text_color || defaultConfig.text_color};">${icons.lock}</span>
                    <input 
                      id="cadastro-senha" 
                      type="password" 
                      placeholder="Crie uma senha"
                      style="width: 100%; padding: 12px 12px 12px 42px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};"
                      required
                    />
                  </div>
                </div>
                
                <div>
                  <label for="cadastro-confirma-senha" style="display: block; margin-bottom: 8px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">Confirmar Senha</label>
                  <div style="position: relative;">
                    <span style="position: absolute; left: 12px; top: 50%; transform: translateY(-50%); opacity: 0.5; color: ${config.text_color || defaultConfig.text_color};">${icons.lock}</span>
                    <input 
                      id="cadastro-confirma-senha" 
                      type="password" 
                      placeholder="Confirme sua senha"
                      style="width: 100%; padding: 12px 12px 12px 42px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};"
                      required
                    />
                  </div>
                </div>
                
                <button 
                  id="btn-cadastro" 
                  type="submit"
                  style="width: 100%; padding: 14px; border: none; border-radius: 8px; font-size: 15px; font-weight: 600; cursor: pointer; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: #fff; transition: opacity 0.2s;"
                  onmouseover="this.style.opacity='0.9'"
                  onmouseout="this.style.opacity='1'"
                >
                  <span id="btn-cadastro-text">Criar Conta</span>
                </button>
              </form>
              
              <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}20; text-align: center;">
                <p style="margin: 0 0 12px 0; font-size: 12px; opacity: 0.6; color: ${config.text_color || defaultConfig.text_color};">Credenciais de demonstração:</p>
                <div style="display: flex; flex-direction: column; gap: 6px; font-size: 12px; color: ${config.text_color || defaultConfig.text_color};">
                  <div><strong>Admin:</strong> <code id="demo-admin-user" style="background: ${config.background_color || defaultConfig.background_color}; padding: 2px 6px; border-radius: 4px;"></code> / <code id="demo-admin-pass" style="background: ${config.background_color || defaultConfig.background_color}; padding: 2px 6px; border-radius: 4px;"></code></div>
                  <div><strong>Funcionário:</strong> cadastre-se com seu CPF</div>
                </div>
              </div>
            </div>
          </div>
        </div>
      `;
      
      applyConfigToLogin(config);
      attachLoginListeners();
    }
    
    function attachLoginListeners() {
      // Bot��o Ir para Cadastro
      const btnIrCadastro = $('btn-ir-cadastro');
      if (btnIrCadastro) {
        btnIrCadastro.addEventListener('click', () => {
          showCadastro = true;
          renderLogin();
        });
      }
      
      // Formulário de Login
      const loginForm = $('login-form');
      if (loginForm) {
        loginForm.addEventListener('submit', (e) => {
          e.preventDefault();
          
          const usuario = $('login-usuario').value.trim();
          const senha = $('login-senha').value.trim();
          const config = window.elementSdk?.config || defaultConfig;
          
          if (!usuario || !senha) {
            showMessage('Preencha usuário e senha', 'error');
            return;
          }
          
          const adminUser = config.usuario_admin || defaultConfig.usuario_admin;
          const adminPass = config.senha_admin || defaultConfig.senha_admin;
          
          if (usuario === adminUser && senha === adminPass) {
            currentUser = { tipo: 'admin', nome: 'Administrador' };
            showMessage('Login realizado com sucesso!', 'success');
            render();
          } else {
            // Verificar se o usuário está cadastrado (usando CPF como usuário)
            const cpfLimpo = usuario.replace(/\D/g, '');
            const usuarioCadastrado = currentData.find(u => 
              u.tipo_usuario === 'usuario_cadastrado' && 
              u.cpf === cpfLimpo && 
              u.senha === senha
            );
            
            if (usuarioCadastrado) {
              currentUser = { tipo: 'funcionario', nome: usuarioCadastrado.nome_completo };
              showMessage(`Bem-vindo, ${usuarioCadastrado.nome_completo}!`, 'success');
              render();
            } else {
              showMessage('CPF ou senha incorretos', 'error');
            }
          }
        });
      }
      
      // Máscara de CPF
      const cpfInput = $('cadastro-cpf');
      if (cpfInput) {
        cpfInput.addEventListener('input', (e) => {
          let value = e.target.value.replace(/\D/g, '');
          if (value.length > 11) value = value.slice(0, 11);
          
          if (value.length > 9) {
            value = value.replace(/(\d{3})(\d{3})(\d{3})(\d{1,2})/, '$1.$2.$3-$4');
          } else if (value.length > 6) {
            value = value.replace(/(\d{3})(\d{3})(\d{1,3})/, '$1.$2.$3');
          } else if (value.length > 3) {
            value = value.replace(/(\d{3})(\d{1,3})/, '$1.$2');
          }
          
          e.target.value = value;
        });
      }
      
      // Formulário de Cadastro
      const cadastroForm = $('cadastro-form');
      if (cadastroForm) {
        cadastroForm.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          if (!window.dataSdk) {
            showMessage('Sistema de dados não disponível', 'error');
            return;
          }
          
          if (currentRecordCount >= 999) {
            showMessage('Limite máximo de cadastros atingido', 'error');
            return;
          }
          
          const nomeCompleto = $('cadastro-nome').value.trim();
          const cpf = $('cadastro-cpf').value.trim().replace(/\D/g, '');
          const senha = $('cadastro-senha').value.trim();
          const confirmaSenha = $('cadastro-confirma-senha').value.trim();
          
          if (!nomeCompleto || !cpf || !senha || !confirmaSenha) {
            showMessage('Preencha todos os campos', 'error');
            return;
          }
          
          if (cpf.length !== 11) {
            showMessage('CPF deve conter 11 dígitos', 'error');
            return;
          }
          
          if (senha !== confirmaSenha) {
            showMessage('As senhas não coincidem', 'error');
            return;
          }
          
          if (senha.length < 4) {
            showMessage('A senha deve ter pelo menos 4 caracteres', 'error');
            return;
          }
          
          // Verificar se o CPF já existe
          const cpfExiste = currentData.find(u => 
            u.tipo_usuario === 'usuario_cadastrado' && 
            u.cpf === cpf
          );
          
          if (cpfExiste) {
            showMessage('Este CPF já está cadastrado', 'error');
            return;
          }
          
          const btnCadastro = $('btn-cadastro');
          const btnText = $('btn-cadastro-text');
          if (btnCadastro && btnText) {
            btnCadastro.disabled = true;
            btnText.innerHTML = '<div class="spinner"></div>';
          }
          
          const now = new Date().toISOString();
          const record = {
            tipo_usuario: 'usuario_cadastrado',
            nome_completo: nomeCompleto,
            cpf: cpf,
            senha: senha,
            data_criacao: now,
            ultimo_update: now
          };
          
          const result = await window.dataSdk.create(record);
          
          if (btnCadastro && btnText) {
            btnCadastro.disabled = false;
            btnText.textContent = 'Criar Conta';
          }
          
          if (result.isOk) {
            showMessage('Conta criada com sucesso! Faça login para continuar.', 'success');
            showCadastro = false;
            renderLogin();
          } else {
            showMessage('Erro ao criar conta', 'error');
          }
        });
      }
    }
    
    // ============================================
    // PAINEL ADMINISTRATIVO
    // ============================================
    function renderAdminPanel() {
      const container = $('app-container');
      const config = window.elementSdk?.config || defaultConfig;
      
      container.innerHTML = `
        <div style="width: 100%; height: 100%; display: flex; flex-direction: column; background: ${config.background_color || defaultConfig.background_color};">
          <!-- Header -->
          <header style="background: ${config.surface_color || defaultConfig.surface_color}; border-bottom: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}30; padding: 16px 32px;">
            <div style="display: flex; align-items: center; justify-content: space-between;">
              <div>
                <h2 id="admin-sidebar-title" style="margin: 0; font-size: 18px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};"></h2>
                <p style="margin: 4px 0 0 0; font-size: 12px; opacity: 0.6; color: ${config.text_color || defaultConfig.text_color};">Painel Administrativo</p>
              </div>
              
              <button id="btn-logout" style="padding: 10px 16px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; background: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color}; transition: background 0.2s;">
                ${icons.logout}
                <span>Sair</span>
              </button>
            </div>
          </header>
          
          <!-- Navigation Bar -->
          <nav style="background: ${config.surface_color || defaultConfig.surface_color}; border-bottom: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}30; padding: 0 32px; display: flex; gap: 4px;">
            <button id="nav-dashboard" class="nav-item" data-section="dashboard" style="padding: 14px 20px; border: none; background: none; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color}; transition: all 0.2s; border-bottom: 3px solid transparent; position: relative;">
              ${icons.dashboard}
              <span>Dashboard</span>
            </button>
            <button id="nav-rids" class="nav-item" data-section="rids" style="padding: 14px 20px; border: none; background: none; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color}; transition: all 0.2s; border-bottom: 3px solid transparent; position: relative;">
              ${icons.file}
              <span>RIDs</span>
            </button>
            <button id="nav-funcionarios" class="nav-item" data-section="funcionarios" style="padding: 14px 20px; border: none; background: none; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color}; transition: all 0.2s; border-bottom: 3px solid transparent; position: relative;">
              ${icons.users}
              <span>Funcionários</span>
            </button>
            <button id="nav-relatorio" class="nav-item" data-section="relatorio" style="padding: 14px 20px; border: none; background: none; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 14px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color}; transition: all 0.2s; border-bottom: 3px solid transparent; position: relative;">
              ${icons.chart}
              <span>Relatórios</span>
            </button>
          </nav>
          
          <!-- Main Content -->
          <main style="flex: 1; overflow-y: auto; height: 100%;" class="scrollable">
            <div id="admin-content" style="padding: 32px; max-width: 1200px; margin: 0 auto;"></div>
          </main>
        </div>
      `;
      
      applyConfigToAdminPanel(config);
      attachAdminListeners();
      renderAdminSection();
    }
    
    function attachAdminListeners() {
      const navItems = document.querySelectorAll('.nav-item');
      navItems.forEach(item => {
        item.addEventListener('click', () => {
          currentAdminSection = item.dataset.section;
          renderAdminSection();
          updateActiveNav();
        });
      });
      
      const btnLogout = $('btn-logout');
      if (btnLogout) {
        btnLogout.addEventListener('click', () => {
          currentUser = null;
          currentAdminSection = 'dashboard';
          showMessage('Logout realizado com sucesso', 'info');
          render();
        });
      }
      
      updateActiveNav();
    }
    
    function updateActiveNav() {
      const config = window.elementSdk?.config || defaultConfig;
      const navItems = document.querySelectorAll('.nav-item');
      navItems.forEach(item => {
        if (item.dataset.section === currentAdminSection) {
          item.style.borderBottomColor = config.primary_action_color || defaultConfig.primary_action_color;
          item.style.color = config.primary_action_color || defaultConfig.primary_action_color;
          item.style.background = 'none';
        } else {
          item.style.borderBottomColor = 'transparent';
          item.style.color = config.text_color || defaultConfig.text_color;
          item.style.background = 'none';
        }
      });
    }
    
    function renderAdminSection() {
      const content = $('admin-content');
      if (!content) return;
      
      if (currentAdminSection === 'dashboard') {
        renderDashboard(content);
      } else if (currentAdminSection === 'rids') {
        renderRidsSection(content);
      } else if (currentAdminSection === 'funcionarios') {
        renderFuncionariosSection(content);
      } else if (currentAdminSection === 'relatorio') {
        renderRelatorioSection(content);
      }
    }
    
    // ============================================
    // DASHBOARD
    // ============================================
    function renderDashboard(content) {
      const config = window.elementSdk?.config || defaultConfig;
      
      // Filtrar apenas RIDs (excluir usuários cadastrados)
      const ridsData = currentData.filter(r => r.tipo_usuario === 'funcionario');
      
      const total = ridsData.length;
      const abertos = ridsData.filter(r => r.status === 'Em aberto').length;
      const emAnalise = ridsData.filter(r => r.status === 'Vencidos').length;
      const fechados = ridsData.filter(r => r.status === 'Corrigidos').length;
      
      const funcionarios = Array.from(new Set(ridsData.map(r => r.nome_funcionario).filter(Boolean)));
      
      content.innerHTML = `
        <div class="fade-in">
          <h1 style="margin: 0 0 8px 0; font-size: 28px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Dashboard</h1>
          <p style="margin: 0 0 32px 0; opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">Visão geral do sistema</p>
          
          <!-- Cards de estatísticas -->
          <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 32px;">
            <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                <span style="font-size: 13px; opacity: 0.6; color: ${config.text_color || defaultConfig.text_color};">Total de RIDs</span>
                <span style="color: ${config.primary_action_color || defaultConfig.primary_action_color};">${icons.file}</span>
              </div>
              <div style="font-size: 32px; font-weight: 700; color: ${config.text_color || defaultConfig.text_color};">${total}</div>
            </div>
            
            <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                <span style="font-size: 13px; opacity: 0.6; color: ${config.text_color || defaultConfig.text_color};">Em aberto</span>
                <span style="color: #ff6b6b;">${icons.file}</span>
              </div>
              <div style="font-size: 32px; font-weight: 700; color: ${config.text_color || defaultConfig.text_color};">${abertos}</div>
            </div>
            
            <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                <span style="font-size: 13px; opacity: 0.6; color: ${config.text_color || defaultConfig.text_color};">Vencidos</span>
                <span style="color: ${config.primary_action_color || defaultConfig.primary_action_color};">${icons.file}</span>
              </div>
              <div style="font-size: 32px; font-weight: 700; color: ${config.text_color || defaultConfig.text_color};">${emAnalise}</div>
            </div>
            
            <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 12px;">
                <span style="font-size: 13px; opacity: 0.6; color: ${config.text_color || defaultConfig.text_color};">Corrigidos</span>
                <span style="color: #51cf66;">${icons.check}</span>
              </div>
              <div style="font-size: 32px; font-weight: 700; color: ${config.text_color || defaultConfig.text_color};">${fechados}</div>
            </div>
          </div>
          
          <!-- Últimos RIDs -->
          <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); margin-bottom: 24px;">
            <h2 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">RIDs Registrados Esta Semana</h2>
            
            <!-- Cabeçalho das colunas -->
            <div style="display: grid; grid-template-columns: 80px 2fr 1.5fr 1.2fr 1fr; gap: 16px; padding: 12px 16px; background: ${config.background_color || defaultConfig.background_color}; border-radius: 8px; margin-bottom: 12px;">
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">ID</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Assunto</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Funcionário</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Data</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Status</div>
            </div>
            
            <div id="dashboard-recent-rids" style="max-height: 300px; overflow-y: auto;" class="scrollable"></div>
          </div>
          
          <!-- Top 3 Funcionários do M��s -->
          <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
            <h2 style="margin: 0 0 20px 0; font-size: 18px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Top 3 Funcionários com Mais RIDs</h2>
            
            <!-- Cabeçalho das colunas -->
            <div style="display: grid; grid-template-columns: 100px 2fr 1.5fr 1fr 1.5fr; gap: 16px; padding: 12px 16px; background: ${config.background_color || defaultConfig.background_color}; border-radius: 8px; margin-bottom: 12px;">
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Posição</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Funcionário</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Departamento</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Total RIDs</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">Última Atualização</div>
            </div>
            
            <div id="dashboard-top-funcionarios" style="max-height: 300px; overflow-y: auto;" class="scrollable"></div>
          </div>
        </div>
      `;
      
      renderDashboardRecentRids();
      renderDashboardTopFuncionarios();
    }
    
    function renderDashboardTopFuncionarios() {
      const container = $('dashboard-top-funcionarios');
      if (!container) return;
      
      const config = window.elementSdk?.config || defaultConfig;
      
      // Filtrar apenas RIDs (excluir usuários cadastrados)
      const ridsData = currentData.filter(r => r.tipo_usuario === 'funcionario');
      
      // Contar RIDs por funcionário e obter última atualização
      const contagemPorFuncionario = {};
      ridsData.forEach(r => {
        if (r.nome_funcionario) {
          if (!contagemPorFuncionario[r.nome_funcionario]) {
            contagemPorFuncionario[r.nome_funcionario] = {
              count: 0,
              ultimaAtualizacao: r.ultimo_update || r.data_criacao
            };
          }
          contagemPorFuncionario[r.nome_funcionario].count++;
          
          // Atualizar para a data mais recente
          const dataAtual = new Date(r.ultimo_update || r.data_criacao);
          const dataArmazenada = new Date(contagemPorFuncionario[r.nome_funcionario].ultimaAtualizacao);
          if (dataAtual > dataArmazenada) {
            contagemPorFuncionario[r.nome_funcionario].ultimaAtualizacao = r.ultimo_update || r.data_criacao;
          }
        }
      });
      
      // Converter para array e ordenar
      const ranking = Object.entries(contagemPorFuncionario)
        .map(([nome, data]) => ({ 
          nome, 
          count: data.count,
          ultimaAtualizacao: data.ultimaAtualizacao
        }))
        .sort((a, b) => b.count - a.count)
        .slice(0, 3);
      
      if (ranking.length === 0) {
        container.innerHTML = `<p style="opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">Nenhum RID registrado ainda</p>`;
        return;
      }
      
      const medals = [
        `<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#FFD700" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>`,
        `<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#C0C0C0" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>`,
        `<svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#CD7F32" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="7"></circle><polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"></polyline></svg>`
      ];
      const departamentos = ['Produção', 'Manutenção', 'Qualidade']; // Departamentos de exemplo
      
      container.innerHTML = ranking.map((func, index) => {
        const dataFormatada = new Date(func.ultimaAtualizacao).toLocaleDateString('pt-BR', { 
          day: '2-digit', 
          month: '2-digit', 
          year: 'numeric',
          hour: '2-digit',
          minute: '2-digit'
        });
        
        // Atribuir departamento baseado no índice (exemplo)
        const departamento = departamentos[index % departamentos.length];
        
        return `
        <div style="display: grid; grid-template-columns: 100px 2fr 1.5fr 1fr 1.5fr; gap: 16px; padding: 14px 16px; border-bottom: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}20; align-items: center;">
          <div style="display: flex; align-items: center; gap: 8px;">
            <span>${medals[index]}</span>
            <span style="font-size: 13px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">${index + 1}º</span>
          </div>
          <div style="font-size: 13px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">${func.nome}</div>
          <div style="font-size: 13px; color: ${config.text_color || defaultConfig.text_color};">${departamento}</div>
          <div style="font-size: 13px; font-weight: 700; color: ${config.primary_action_color || defaultConfig.primary_action_color};">${func.count}</div>
          <div style="font-size: 13px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">${dataFormatada}</div>
        </div>
      `;
      }).join('');
    }
    
    function renderDashboardRecentRids() {
      const container = $('dashboard-recent-rids');
      if (!container) return;
      
      const config = window.elementSdk?.config || defaultConfig;
      
      // Filtrar apenas RIDs (excluir usuários cadastrados)
      const ridsData = currentData.filter(r => r.tipo_usuario === 'funcionario');
      
      // Calcular in��cio da semana (domingo)
      const hoje = new Date();
      const diaSemana = hoje.getDay(); // 0 = domingo, 1 = segunda, etc
      const inicioSemana = new Date(hoje);
      inicioSemana.setDate(hoje.getDate() - diaSemana);
      inicioSemana.setHours(0, 0, 0, 0);
      
      // Filtrar RIDs da semana atual
      const ridsDaSemana = ridsData.filter(r => {
        const dataRid = new Date(r.data_criacao);
        return dataRid >= inicioSemana;
      });
      
      const recent = ridsDaSemana.slice().sort((a, b) => 
        new Date(b.data_criacao).getTime() - new Date(a.data_criacao).getTime()
      );
      
      if (recent.length === 0) {
        container.innerHTML = `<p style="opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color}; padding: 20px; text-align: center;">Nenhum RID registrado esta semana</p>`;
        return;
      }
      
      container.innerHTML = recent.map((r, index) => {
        const dataFormatada = new Date(r.data_criacao).toLocaleDateString('pt-BR', { 
          day: '2-digit', 
          month: '2-digit', 
          year: 'numeric' 
        });
        
        return `
        <div style="display: grid; grid-template-columns: 80px 2fr 1.5fr 1.2fr 1fr; gap: 16px; padding: 14px 16px; border-bottom: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}20; align-items: center;">
          <div style="font-size: 13px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">#${String(index + 1).padStart(3, '0')}</div>
          <div style="font-size: 13px; color: ${config.text_color || defaultConfig.text_color}; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${r.titulo}</div>
          <div style="font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">${r.nome_funcionario}</div>
          <div style="font-size: 13px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">${dataFormatada}</div>
          <div>
            <span style="padding: 4px 12px; background: ${getStatusColor(r.status, config)}20; color: ${getStatusColor(r.status, config)}; border-radius: 6px; font-size: 12px; font-weight: 500; white-space: nowrap; display: inline-block;">
              ${r.status}
            </span>
          </div>
        </div>
      `;
      }).join('');
    }
    
    function getStatusColor(status, config) {
      if (status === 'Em aberto') return '#ff6b6b';
      if (status === 'Vencidos') return config.primary_action_color || defaultConfig.primary_action_color;
      return '#51cf66';
    }
    
    function getRiscoColor(risco) {
      if (risco === 'Crítico') return '#dc2626';
      if (risco === 'Alto') return '#ea580c';
      if (risco === 'Médio') return '#f59e0b';
      if (risco === 'Baixo') return '#10b981';
      return '#6b7280';
    }
    
    // ============================================
    // SEÇÃO RIDs
    // ============================================
    function renderRidsSection(content) {
      const config = window.elementSdk?.config || defaultConfig;
      
      content.innerHTML = `
        <div class="fade-in">
          <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px;">
            <div>
              <h1 style="margin: 0 0 8px 0; font-size: 28px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Gestão de RIDs</h1>
              <p style="margin: 0; opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">Gerencie todos os registros do sistema</p>
            </div>
            <button id="btn-novo-rid" style="padding: 12px 20px; border: none; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: #fff; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 8px; transition: opacity 0.2s;">
              ${icons.plus}
              <span>Novo RID</span>
            </button>
          </div>
          
          <!-- Botão Filtros -->
          <div style="margin-bottom: 20px;">
            <button id="btn-toggle-filtros" style="padding: 10px 16px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color}; transition: background 0.2s;">
              <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"></polygon></svg>
              <span>Filtros</span>
            </button>
          </div>
          
          <!-- Filtros (inicialmente escondidos) -->
          <div id="filtros-container" style="display: none; background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
            <div style="display: flex; flex-wrap: wrap; gap: 16px; align-items: center;">
              <div style="flex: 1; min-width: 200px;">
                <label for="filter-status" style="display: block; margin-bottom: 6px; font-size: 12px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">Status</label>
                <select id="filter-status" style="width: 100%; padding: 8px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 6px; font-size: 13px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};">
                  <option value="todos">Todos</option>
                  <option value="Em aberto">Em aberto</option>
                  <option value="Vencidos">Vencidos</option>
                  <option value="Corrigidos">Corrigidos</option>
                </select>
              </div>
              <div style="flex: 1; min-width: 200px;">
                <label for="filter-funcionario" style="display: block; margin-bottom: 6px; font-size: 12px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">Funcionário</label>
                <select id="filter-funcionario" style="width: 100%; padding: 8px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 6px; font-size: 13px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};">
                  <option value="todos">Todos</option>
                </select>
              </div>
            </div>
          </div>
          
          <!-- Lista de RIDs -->
          <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); overflow: hidden;">
            <!-- Cabeçalho das colunas -->
            <div style="display: grid; grid-template-columns: 80px 1.5fr 1fr 1.2fr 2fr 1fr 1fr 1fr; gap: 16px; padding: 16px 20px; background: ${config.background_color || defaultConfig.background_color}; border-bottom: 2px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}30;">
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">ID</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">Emitente</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">Setor</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">Local</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">Descrição</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">Risco</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">Data</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">Status</div>
            </div>
            
            <!-- Lista de RIDs -->
            <div id="rids-list" style="display: flex; flex-direction: column;"></div>
          </div>
          
          <!-- Modal Visualizar RID -->
          <div id="modal-visualizar-rid" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
            <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 16px; padding: 32px; width: 90%; max-width: 700px; max-height: 90%; overflow-y: auto;" class="scrollable">
              <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 24px;">
                <h2 style="margin: 0; font-size: 22px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Detalhes do RID</h2>
                <button id="btn-fechar-visualizar" style="padding: 8px; border: none; background: none; cursor: pointer; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.6; transition: opacity 0.2s;" onmouseover="this.style.opacity='1'" onmouseout="this.style.opacity='0.6'">
                  ${icons.x}
                </button>
              </div>
              
              <div id="rid-detalhes-content" style="display: flex; flex-direction: column; gap: 20px;">
                <!-- Conteúdo será preenchido dinamicamente -->
              </div>
              
              <div style="margin-top: 24px; padding-top: 24px; border-top: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}20;">
                <h3 style="margin: 0 0 16px 0; font-size: 16px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Editar RID</h3>
                <form id="form-editar-rid" style="display: flex; flex-direction: column; gap: 16px;">
                  <div>
                    <label for="editar-rid-status" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">Status</label>
                    <select id="editar-rid-status" style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};">
                      <option value="Em aberto">Em aberto</option>
                      <option value="Vencidos">Vencidos</option>
                      <option value="Corrigidos">Corrigidos</option>
                    </select>
                  </div>
                  
                  <div>
                    <label for="editar-rid-risco" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">Classificação de Risco</label>
                    <select id="editar-rid-risco" style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};">
                      <option value="Baixo">Baixo</option>
                      <option value="Médio">Médio</option>
                      <option value="Alto">Alto</option>
                      <option value="Crítico">Crítico</option>
                    </select>
                  </div>
                  
                  <div style="display: flex; gap: 12px; margin-top: 8px;">
                    <button type="button" id="btn-cancelar-editar" style="flex: 1; padding: 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; background: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; color: ${config.text_color || defaultConfig.text_color};">
                      Cancelar
                    </button>
                    <button type="button" id="btn-designar-rid" style="flex: 1; padding: 12px; border: 1px solid ${config.primary_action_color || defaultConfig.primary_action_color}; background: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; color: ${config.primary_action_color || defaultConfig.primary_action_color};">
                      Designar
                    </button>
                    <button type="submit" id="btn-salvar-edicao" style="flex: 1; padding: 12px; border: none; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: #fff; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">
                      <span id="btn-salvar-edicao-text">Salvar Alterações</span>
                    </button>
                  </div>
                </form>
              </div>
            </div>
          </div>
          
          <!-- Modal Novo RID -->
          <div id="modal-novo-rid" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
            <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 16px; padding: 32px; width: 90%; max-width: 500px; max-height: 90%; overflow-y: auto;" class="scrollable">
              <h2 style="margin: 0 0 24px 0; font-size: 22px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Novo RID</h2>
              <form id="form-novo-rid" style="display: flex; flex-direction: column; gap: 20px;">
                <div>
                  <label for="novo-rid-funcionario" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">Funcionário</label>
                  <input id="novo-rid-funcionario" type="text" required style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};" />
                </div>
                <div>
                  <label for="novo-rid-titulo" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">Título</label>
                  <input id="novo-rid-titulo" type="text" required style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};" />
                </div>
                <div>
                  <label for="novo-rid-descricao" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">Descrição</label>
                  <textarea id="novo-rid-descricao" required rows="4" style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; resize: vertical; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};"></textarea>
                </div>
                <div>
                  <label for="novo-rid-status" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">Status</label>
                  <select id="novo-rid-status" style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};">
                    <option value="Em aberto">Em aberto</option>
                    <option value="Vencidos">Vencidos</option>
                    <option value="Corrigidos">Corrigidos</option>
                  </select>
                </div>
                <div style="display: flex; gap: 12px; margin-top: 8px;">
                  <button type="button" id="btn-cancelar-rid" style="flex: 1; padding: 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; background: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; color: ${config.text_color || defaultConfig.text_color};">
                    Cancelar
                  </button>
                  <button type="submit" id="btn-salvar-rid" style="flex: 1; padding: 12px; border: none; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: #fff; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">
                    <span id="btn-salvar-rid-text">Salvar</span>
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      `;
      
      attachRidsListeners();
      renderRidsList();
    }
    
    let ridSendoEditado = null;
    
    function attachRidsListeners() {
      const btnNovo = $('btn-novo-rid');
      const modal = $('modal-novo-rid');
      const btnCancelar = $('btn-cancelar-rid');
      const form = $('form-novo-rid');
      
      // Botão toggle filtros
      const btnToggleFiltros = $('btn-toggle-filtros');
      const filtrosContainer = $('filtros-container');
      if (btnToggleFiltros && filtrosContainer) {
        btnToggleFiltros.addEventListener('click', () => {
          if (filtrosContainer.style.display === 'none') {
            filtrosContainer.style.display = 'block';
            filtrosContainer.classList.add('fade-in');
          } else {
            filtrosContainer.style.display = 'none';
          }
        });
      }
      
      if (btnNovo && modal) {
        btnNovo.addEventListener('click', () => {
          if (currentRecordCount >= 999) {
            showMessage('Limite máximo de 999 RIDs atingido', 'error');
            return;
          }
          modal.style.display = 'flex';
        });
      }
      
      if (btnCancelar && modal) {
        btnCancelar.addEventListener('click', () => {
          modal.style.display = 'none';
          form.reset();
        });
      }
      
      if (modal) {
        modal.addEventListener('click', (e) => {
          if (e.target === modal) {
            modal.style.display = 'none';
            form.reset();
          }
        });
      }
      
      if (form) {
        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          if (!window.dataSdk) {
            showMessage('Sistema de dados não disponível', 'error');
            return;
          }
          
          if (currentRecordCount >= 999) {
            showMessage('Limite máximo de 999 RIDs atingido', 'error');
            return;
          }
          
          const funcionario = $('novo-rid-funcionario').value.trim();
          const titulo = $('novo-rid-titulo').value.trim();
          const descricao = $('novo-rid-descricao').value.trim();
          const status = $('novo-rid-status').value;
          
          if (!funcionario || !titulo || !descricao) {
            showMessage('Preencha todos os campos', 'error');
            return;
          }
          
          const btnSalvar = $('btn-salvar-rid');
          const btnText = $('btn-salvar-rid-text');
          if (btnSalvar && btnText) {
            btnSalvar.disabled = true;
            btnText.innerHTML = '<div class="spinner"></div>';
          }
          
          const now = new Date().toISOString();
          const record = {
            tipo_usuario: 'funcionario',
            nome_funcionario: funcionario,
            titulo,
            descricao,
            status,
            data_criacao: now,
            ultimo_update: now
          };
          
          const result = await window.dataSdk.create(record);
          
          if (btnSalvar && btnText) {
            btnSalvar.disabled = false;
            btnText.textContent = 'Salvar';
          }
          
          if (result.isOk) {
            showMessage('RID criado com sucesso!', 'success');
            modal.style.display = 'none';
            form.reset();
          } else {
            showMessage('Erro ao criar RID', 'error');
          }
        });
      }
      
      const filterStatus = $('filter-status');
      const filterFunc = $('filter-funcionario');
      
      if (filterStatus) {
        filterStatus.addEventListener('change', renderRidsList);
      }
      if (filterFunc) {
        filterFunc.addEventListener('change', renderRidsList);
      }
      
      // Modal Visualizar RID
      const modalVisualizar = $('modal-visualizar-rid');
      const btnFecharVisualizar = $('btn-fechar-visualizar');
      const btnCancelarEditar = $('btn-cancelar-editar');
      const formEditar = $('form-editar-rid');
      
      if (btnFecharVisualizar && modalVisualizar) {
        btnFecharVisualizar.addEventListener('click', () => {
          modalVisualizar.style.display = 'none';
          ridSendoEditado = null;
        });
      }
      
      if (btnCancelarEditar && modalVisualizar) {
        btnCancelarEditar.addEventListener('click', () => {
          modalVisualizar.style.display = 'none';
          ridSendoEditado = null;
        });
      }
      
      if (modalVisualizar) {
        modalVisualizar.addEventListener('click', (e) => {
          if (e.target === modalVisualizar) {
            modalVisualizar.style.display = 'none';
            ridSendoEditado = null;
          }
        });
      }
      
      if (formEditar) {
        formEditar.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          if (!window.dataSdk || !ridSendoEditado) {
            showMessage('Erro ao salvar alterações', 'error');
            return;
          }
          
          const novoStatus = $('editar-rid-status').value;
          const novoRisco = $('editar-rid-risco').value;
          
          const btnSalvar = $('btn-salvar-edicao');
          const btnText = $('btn-salvar-edicao-text');
          if (btnSalvar && btnText) {
            btnSalvar.disabled = true;
            btnText.innerHTML = '<div class="spinner"></div>';
          }
          
          const ridAtualizado = {
            ...ridSendoEditado,
            status: novoStatus,
            classificacao_risco: novoRisco
          };
          
          const result = await window.dataSdk.update(ridAtualizado);
          
          if (btnSalvar && btnText) {
            btnSalvar.disabled = false;
            btnText.textContent = 'Salvar Alterações';
          }
          
          if (result.isOk) {
            showMessage('RID atualizado com sucesso!', 'success');
            if (modalVisualizar) modalVisualizar.style.display = 'none';
            ridSendoEditado = null;
          } else {
            showMessage('Erro ao atualizar RID', 'error');
          }
        });
      }
      
    }
    
    function attachRidRowListeners() {
      // Esta função será chamada após renderizar a lista
    }
    
    function abrirModalVisualizarRid(rid) {
      const modal = $('modal-visualizar-rid');
      const content = $('rid-detalhes-content');
      const config = window.elementSdk?.config || defaultConfig;
      
      if (!modal || !content) return;
      
      ridSendoEditado = rid;
      
      // Preencher detalhes
      const dataFormatada = new Date(rid.data_criacao).toLocaleDateString('pt-BR', { 
        day: '2-digit', 
        month: '2-digit', 
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit'
      });
      
      const emitente = rid.emitente || rid.nome_funcionario || '-';
      const tipoContrato = rid.tipo_contrato || '-';
      const unidade = rid.unidade || '-';
      const setor = rid.setor || '-';
      const dataOcorrencia = rid.data_ocorrencia ? new Date(rid.data_ocorrencia).toLocaleDateString('pt-BR') : '-';
      const incidente = rid.incidente || '-';
      const origem = rid.origem_deteccao || '-';
      const local = rid.local_ocorrencia || '-';
      const descricao = rid.descricao || '-';
      const risco = rid.classificacao_risco || '-';
      const acao = rid.acao_imediata || '-';
      const status = rid.status || '-';
      
      content.innerHTML = `
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div>
            <div style="font-size: 12px; font-weight: 600; opacity: 0.6; margin-bottom: 4px; color: ${config.text_color || defaultConfig.text_color};">Emitente</div>
            <div style="font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">${emitente}</div>
          </div>
          <div>
            <div style="font-size: 12px; font-weight: 600; opacity: 0.6; margin-bottom: 4px; color: ${config.text_color || defaultConfig.text_color};">Tipo de Contrato</div>
            <div style="font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">${tipoContrato}</div>
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div>
            <div style="font-size: 12px; font-weight: 600; opacity: 0.6; margin-bottom: 4px; color: ${config.text_color || defaultConfig.text_color};">Unidade</div>
            <div style="font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">${unidade}</div>
          </div>
          <div>
            <div style="font-size: 12px; font-weight: 600; opacity: 0.6; margin-bottom: 4px; color: ${config.text_color || defaultConfig.text_color};">Setor</div>
            <div style="font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">${setor}</div>
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div>
            <div style="font-size: 12px; font-weight: 600; opacity: 0.6; margin-bottom: 4px; color: ${config.text_color || defaultConfig.text_color};">Data da Ocorrência</div>
            <div style="font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">${dataOcorrencia}</div>
          </div>
          <div>
            <div style="font-size: 12px; font-weight: 600; opacity: 0.6; margin-bottom: 4px; color: ${config.text_color || defaultConfig.text_color};">Data de Registro</div>
            <div style="font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">${dataFormatada}</div>
          </div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div>
            <div style="font-size: 12px; font-weight: 600; opacity: 0.6; margin-bottom: 4px; color: ${config.text_color || defaultConfig.text_color};">Incidente/Desvio</div>
            <div style="font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">${incidente}</div>
          </div>
          <div>
            <div style="font-size: 12px; font-weight: 600; opacity: 0.6; margin-bottom: 4px; color: ${config.text_color || defaultConfig.text_color};">Origem da Detecção</div>
            <div style="font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">${origem}</div>
          </div>
        </div>
        
        <div>
          <div style="font-size: 12px; font-weight: 600; opacity: 0.6; margin-bottom: 4px; color: ${config.text_color || defaultConfig.text_color};">Local da Ocorrência</div>
          <div style="font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">${local}</div>
        </div>
        
        <div>
          <div style="font-size: 12px; font-weight: 600; opacity: 0.6; margin-bottom: 4px; color: ${config.text_color || defaultConfig.text_color};">Descrição da Ocorrência</div>
          <div style="font-size: 14px; line-height: 1.6; color: ${config.text_color || defaultConfig.text_color};">${descricao}</div>
        </div>
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px;">
          <div>
            <div style="font-size: 12px; font-weight: 600; opacity: 0.6; margin-bottom: 4px; color: ${config.text_color || defaultConfig.text_color};">Classificação de Risco</div>
            <div style="font-size: 14px; font-weight: 600; color: ${getRiscoColor(risco)};">${risco}</div>
          </div>
          <div>
            <div style="font-size: 12px; font-weight: 600; opacity: 0.6; margin-bottom: 4px; color: ${config.text_color || defaultConfig.text_color};">Status</div>
            <div>
              <span style="padding: 6px 12px; background: ${getStatusColor(status, config)}20; color: ${getStatusColor(status, config)}; border-radius: 6px; font-size: 13px; font-weight: 500; display: inline-block;">
                ${status}
              </span>
            </div>
          </div>
        </div>
        
        <div>
          <div style="font-size: 12px; font-weight: 600; opacity: 0.6; margin-bottom: 4px; color: ${config.text_color || defaultConfig.text_color};">Ação Imediata</div>
          <div style="font-size: 14px; line-height: 1.6; color: ${config.text_color || defaultConfig.text_color};">${acao}</div>
        </div>
      `;
      
      // Preencher formulário de edição
      const selectStatus = $('editar-rid-status');
      const selectRisco = $('editar-rid-risco');
      
      if (selectStatus) selectStatus.value = rid.status || 'Em aberto';
      if (selectRisco) selectRisco.value = rid.classificacao_risco || 'Baixo';
      
      modal.style.display = 'flex';
    }
    
    function renderRidsList() {
      const container = $('rids-list');
      if (!container) return;
      
      const config = window.elementSdk?.config || defaultConfig;
      const filterStatus = $('filter-status')?.value || 'todos';
      const filterFunc = $('filter-funcionario')?.value || 'todos';
      
      // Filtrar apenas RIDs (excluir usuários cadastrados)
      const ridsData = currentData.filter(r => r.tipo_usuario === 'funcionario');
      
      // Atualizar select de funcionários
      const selectFunc = $('filter-funcionario');
      if (selectFunc) {
        const funcionarios = Array.from(new Set(ridsData.map(r => r.nome_funcionario).filter(Boolean))).sort();
        const currentValue = selectFunc.value;
        selectFunc.innerHTML = '<option value="todos">Todos</option>' + 
          funcionarios.map(f => `<option value="${f}">${f}</option>`).join('');
        if (currentValue && (currentValue === 'todos' || funcionarios.includes(currentValue))) {
          selectFunc.value = currentValue;
        }
      }
      
      let filtered = ridsData;
      if (filterStatus !== 'todos') {
        filtered = filtered.filter(r => r.status === filterStatus);
      }
      if (filterFunc !== 'todos') {
        filtered = filtered.filter(r => r.nome_funcionario === filterFunc);
      }
      
      if (filtered.length === 0) {
        container.innerHTML = `
          <div style="padding: 40px; text-align: center;">
            <p style="margin: 0; opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">Nenhum RID encontrado</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = filtered
        .slice()
        .sort((a, b) => new Date(b.data_criacao).getTime() - new Date(a.data_criacao).getTime())
        .map((r, index) => {
          const dataFormatada = new Date(r.data_criacao).toLocaleDateString('pt-BR', { 
            day: '2-digit', 
            month: '2-digit', 
            year: 'numeric' 
          });
          
          const emitente = r.emitente || r.nome_funcionario || '-';
          const setor = r.setor || '-';
          const local = r.local_ocorrencia || '-';
          const descricao = r.descricao || '-';
          const risco = r.classificacao_risco || '-';
          
          return `
          <div class="rid-row" data-rid-id="${r.__backendId}" style="display: grid; grid-template-columns: 80px 1.5fr 1fr 1.2fr 2fr 1fr 1fr 1fr; gap: 16px; padding: 16px 20px; border-bottom: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}20; align-items: center; transition: background 0.2s; cursor: pointer;" onmouseover="this.style.background='${config.background_color || defaultConfig.background_color}50'" onmouseout="this.style.background='transparent'">
            <div style="font-size: 13px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">#${String(index + 1).padStart(3, '0')}</div>
            <div style="font-size: 13px; color: ${config.text_color || defaultConfig.text_color}; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${emitente}">${emitente}</div>
            <div style="font-size: 13px; color: ${config.text_color || defaultConfig.text_color}; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${setor}">${setor}</div>
            <div style="font-size: 13px; color: ${config.text_color || defaultConfig.text_color}; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${local}">${local}</div>
            <div style="font-size: 13px; color: ${config.text_color || defaultConfig.text_color}; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${descricao}">${descricao}</div>
            <div style="font-size: 12px; font-weight: 600; color: ${getRiscoColor(risco)}; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;">${risco}</div>
            <div style="font-size: 13px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">${dataFormatada}</div>
            <div>
              <span style="padding: 6px 12px; background: ${getStatusColor(r.status, config)}20; color: ${getStatusColor(r.status, config)}; border-radius: 6px; font-size: 12px; font-weight: 500; white-space: nowrap; display: inline-block;">
                ${r.status}
              </span>
            </div>
          </div>
        `;
        }).join('');
      
      // Adicionar eventos de clique após renderizar
      setTimeout(() => {
        const ridRows = document.querySelectorAll('.rid-row');
        ridRows.forEach(row => {
          row.addEventListener('click', () => {
            const ridId = row.dataset.ridId;
            const rid = currentData.find(r => r.__backendId === ridId);
            if (rid) {
              abrirModalVisualizarRid(rid);
            }
          });
        });
      }, 100);

    }
    
    // ============================================
    // SEÇÃO FUNCIONÁRIOS
    // ============================================
    function renderFuncionariosSection(content) {
      const config = window.elementSdk?.config || defaultConfig;
      
      // Filtrar apenas usuários cadastrados
      const funcionariosCadastrados = currentData.filter(r => r.tipo_usuario === 'usuario_cadastrado');
      
      content.innerHTML = `
        <div class="fade-in">
          <h1 style="margin: 0 0 8px 0; font-size: 28px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Funcionários</h1>
          <p style="margin: 0 0 32px 0; opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">Lista de funcionários cadastrados no sistema</p>
          
          <!-- Lista de Funcionários -->
          <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; box-shadow: 0 2px 8px rgba(0,0,0,0.06); overflow: hidden;">
            <!-- Cabeçalho das colunas -->
            <div style="display: grid; grid-template-columns: 2fr 1.5fr 1.5fr 1.5fr 1fr 1fr; gap: 16px; padding: 16px 20px; background: ${config.background_color || defaultConfig.background_color}; border-bottom: 2px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}30;">
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">Nome</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">CPF</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">Departamento</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">Data Cadastro</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">Status</div>
              <div style="font-size: 12px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">Ações</div>
            </div>
            
            <!-- Lista de funcionários -->
            <div id="funcionarios-list" style="display: flex; flex-direction: column;"></div>
          </div>
        </div>
      `;
      
      renderFuncionariosList();
    }
    
    function renderFuncionariosList() {
      const container = $('funcionarios-list');
      if (!container) return;
      
      const config = window.elementSdk?.config || defaultConfig;
      
      // Filtrar apenas usuários cadastrados
      const funcionariosCadastrados = currentData
        .filter(r => r.tipo_usuario === 'usuario_cadastrado')
        .sort((a, b) => new Date(b.data_criacao).getTime() - new Date(a.data_criacao).getTime());
      
      if (funcionariosCadastrados.length === 0) {
        container.innerHTML = `
          <div style="padding: 40px; text-align: center;">
            <p style="margin: 0; opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">Nenhum funcionário cadastrado ainda</p>
          </div>
        `;
        return;
      }
      
      const departamentos = ['Produção', 'Manutenção', 'Qualidade', 'Administração', 'Logística'];
      
      container.innerHTML = funcionariosCadastrados.map((func, index) => {
        const dataFormatada = new Date(func.data_criacao).toLocaleDateString('pt-BR', { 
          day: '2-digit', 
          month: '2-digit', 
          year: 'numeric' 
        });
        
        const cpfFormatado = func.cpf.replace(/(\d{3})(\d{3})(\d{3})(\d{2})/, '$1.$2.$3-$4');
        const departamento = departamentos[index % departamentos.length];
        
        return `
        <div style="display: grid; grid-template-columns: 2fr 1.5fr 1.5fr 1.5fr 1fr 1fr; gap: 16px; padding: 16px 20px; border-bottom: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}20; align-items: center;">
          <div style="display: flex; align-items: center; gap: 12px;">
            <div style="width: 36px; height: 36px; border-radius: 50%; background: ${config.primary_action_color || defaultConfig.primary_action_color}20; display: flex; align-items: center; justify-content: center; color: ${config.primary_action_color || defaultConfig.primary_action_color}; flex-shrink: 0;">
              ${icons.user}
            </div>
            <div style="font-size: 13px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color}; overflow: hidden; text-overflow: ellipsis; white-space: nowrap;" title="${func.nome_completo}">${func.nome_completo}</div>
          </div>
          <div style="font-size: 13px; color: ${config.text_color || defaultConfig.text_color}; font-family: monospace;">${cpfFormatado}</div>
          <div style="font-size: 13px; color: ${config.text_color || defaultConfig.text_color};">${departamento}</div>
          <div style="font-size: 13px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.7;">${dataFormatada}</div>
          <div>
            <span style="padding: 4px 10px; background: #22c55e20; color: #22c55e; border-radius: 6px; font-size: 11px; font-weight: 600; white-space: nowrap; display: inline-block;">
              ATIVO
            </span>
          </div>
          <div style="display: flex; gap: 8px;">
            <button class="btn-editar-func" data-func-id="${func.__backendId}" style="padding: 6px 10px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; background: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 4px; font-size: 11px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color}; transition: background 0.2s;" onmouseover="this.style.background='${config.background_color || defaultConfig.background_color}'" onmouseout="this.style.background='none'">
              ${icons.edit}
            </button>
            <button class="btn-deletar-func" data-func-id="${func.__backendId}" style="padding: 6px 10px; border: 1px solid #ff6b6b40; background: none; border-radius: 6px; cursor: pointer; display: flex; align-items: center; gap: 4px; font-size: 11px; font-weight: 500; color: #ff6b6b; transition: background 0.2s;" onmouseover="this.style.background='#ff6b6b10'" onmouseout="this.style.background='none'">
              ${icons.trash}
            </button>
          </div>
        </div>
      `;
      }).join('');
      
      // Adicionar eventos de clique após renderizar
      setTimeout(() => {
        const btnsEditar = document.querySelectorAll('.btn-editar-func');
        const btnsDeletar = document.querySelectorAll('.btn-deletar-func');
        
        btnsEditar.forEach(btn => {
          btn.addEventListener('click', () => {
            const funcId = btn.dataset.funcId;
            const func = currentData.find(f => f.__backendId === funcId);
            if (func) {
              showMessage('Funcionalidade de edição em desenvolvimento', 'info');
            }
          });
        });
        
        btnsDeletar.forEach(btn => {
          btn.addEventListener('click', async () => {
            const funcId = btn.dataset.funcId;
            const func = currentData.find(f => f.__backendId === funcId);
            if (func) {
              // Confirmação inline
              const confirmDiv = document.createElement('div');
              confirmDiv.style.cssText = `
                position: fixed;
                top: 50%;
                left: 50%;
                transform: translate(-50%, -50%);
                background: ${config.surface_color || defaultConfig.surface_color};
                padding: 24px;
                border-radius: 12px;
                box-shadow: 0 8px 32px rgba(0,0,0,0.2);
                z-index: 10000;
                min-width: 300px;
              `;
              
              confirmDiv.innerHTML = `
                <h3 style="margin: 0 0 12px 0; font-size: 16px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Confirmar exclusão</h3>
                <p style="margin: 0 0 20px 0; font-size: 13px; color: ${config.text_color || defaultConfig.text_color}; opacity: 0.8;">Tem certeza que deseja excluir o funcionário <strong>${func.nome_completo}</strong>?</p>
                <div style="display: flex; gap: 12px;">
                  <button id="btn-cancelar-delete" style="flex: 1; padding: 10px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; background: none; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; color: ${config.text_color || defaultConfig.text_color};">
                    Cancelar
                  </button>
                  <button id="btn-confirmar-delete" style="flex: 1; padding: 10px; border: none; background: #ff6b6b; color: #fff; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer;">
                    Excluir
                  </button>
                </div>
              `;
              
              document.body.appendChild(confirmDiv);
              
              const btnCancelar = document.getElementById('btn-cancelar-delete');
              const btnConfirmar = document.getElementById('btn-confirmar-delete');
              
              btnCancelar.addEventListener('click', () => {
                confirmDiv.remove();
              });
              
              btnConfirmar.addEventListener('click', async () => {
                if (!window.dataSdk) {
                  showMessage('Sistema de dados não disponível', 'error');
                  confirmDiv.remove();
                  return;
                }
                
                btnConfirmar.disabled = true;
                btnConfirmar.innerHTML = '<div class="spinner"></div>';
                
                const result = await window.dataSdk.delete(func);
                
                if (result.isOk) {
                  showMessage('Funcionário excluído com sucesso!', 'success');
                  confirmDiv.remove();
                } else {
                  showMessage('Erro ao excluir funcionário', 'error');
                  btnConfirmar.disabled = false;
                  btnConfirmar.textContent = 'Excluir';
                }
              });
            }
          });
        });
      }, 100);
    }
    
    // ============================================
    // SEÇÃO RELATÓRIOS
    // ============================================
    function renderRelatorioSection(content) {
      const config = window.elementSdk?.config || defaultConfig;
      
      content.innerHTML = `
        <div class="fade-in">
          <h1 style="margin: 0 0 8px 0; font-size: 28px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Relat����rios</h1>
          <p style="margin: 0 0 32px 0; opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">Análises e relatórios do sistema</p>
          
          <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 60px 40px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
            <div style="color: ${config.secondary_action_color || defaultConfig.secondary_action_color}; margin-bottom: 16px;">
              ${icons.chart}
            </div>
            <h2 style="margin: 0 0 8px 0; font-size: 20px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Em Desenvolvimento</h2>
            <p style="margin: 0; opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">Esta seção estará disponível em breve com relatórios detalhados e análises.</p>
          </div>
        </div>
      `;
    }
    
    // ============================================
    // PAINEL FUNCIONÁRIO
    // ============================================
    function renderFuncionarioPanel() {
      const container = $('app-container');
      const config = window.elementSdk?.config || defaultConfig;
      
      // Filtrar apenas RIDs do funcionário logado (excluir usuários cadastrados)
      const meusRids = currentData.filter(r => 
        r.tipo_usuario === 'funcionario' && r.nome_funcionario === currentUser.nome
      );
      
      container.innerHTML = `
        <div style="width: 100%; height: 100%; display: flex; flex-direction: column; background: ${config.background_color || defaultConfig.background_color};">
          <!-- Header -->
          <header style="background: ${config.surface_color || defaultConfig.surface_color}; border-bottom: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}30; padding: 20px 32px;">
            <div style="display: flex; align-items: center; justify-content: space-between;">
              <div>
                <h1 id="func-panel-title" style="margin: 0 0 4px 0; font-size: 22px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};"></h1>
                <p style="margin: 0; font-size: 13px; opacity: 0.6; color: ${config.text_color || defaultConfig.text_color};">Bem-vindo, ${currentUser.nome}</p>
              </div>
              <button id="btn-func-logout" style="padding: 10px 16px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; background: none; border-radius: 8px; cursor: pointer; display: flex; align-items: center; gap: 8px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">
                ${icons.logout}
                <span>Sair</span>
              </button>
            </div>
          </header>
          
          <!-- Main Content -->
          <main style="flex: 1; overflow-y: auto; padding: 32px;" class="scrollable">
            <div style="max-width: 1000px; margin: 0 auto;">
              <!-- Meus RIDs -->
              <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 12px; padding: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.06);">
                <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 20px;">
                  <h2 style="margin: 0; font-size: 18px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Meus RIDs</h2>
                  <button id="btn-abrir-modal-rid" style="padding: 10px 16px; border: none; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: #fff; border-radius: 8px; font-size: 13px; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 6px; transition: opacity 0.2s;">
                    ${icons.plus}
                    <span>Novo RID</span>
                  </button>
                </div>
                <div id="func-rids-list"></div>
              </div>
            </div>
          </main>
          
          <!-- Modal Novo RID -->
          <div id="modal-func-novo-rid" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 1000; align-items: center; justify-content: center;">
            <div style="background: ${config.surface_color || defaultConfig.surface_color}; border-radius: 16px; padding: 32px; width: 90%; max-width: 600px; max-height: 90%; overflow-y: auto;" class="scrollable">
              <h2 style="margin: 0 0 24px 0; font-size: 22px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">Emissão de RID</h2>
              <form id="form-func-rid" style="display: flex; flex-direction: column; gap: 20px;">
                
                <!-- 1. Emitente -->
                <div>
                  <label for="func-rid-emitente" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">1. Emitente</label>
                  <input id="func-rid-emitente" type="text" required placeholder="Insira o nome do emitente" style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};" />
                </div>
                
                <!-- 2. Tipo de contrato -->
                <div>
                  <label for="func-rid-tipo-contrato" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">2. Tipo de contrato</label>
                  <select id="func-rid-tipo-contrato" required style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};">
                    <option value="">Selecione...</option>
                    <option value="Funcionário">Funcionário</option>
                    <option value="Terceiro Contratado">Terceiro Contratado</option>
                    <option value="Terceiro Eventual">Terceiro Eventual</option>
                    <option value="Visitante">Visitante</option>
                  </select>
                </div>
                
                <!-- 3. Unidade -->
                <div>
                  <label for="func-rid-unidade" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">3. Unidade</label>
                  <input id="func-rid-unidade" type="text" required placeholder="Insira a unidade" style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};" />
                </div>
                
                <!-- 4. Setor do emitente -->
                <div>
                  <label for="func-rid-setor" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">4. Setor do emitente</label>
                  <select id="func-rid-setor" required style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};">
                    <option value="">Selecione...</option>
                    <option value="ADM">ADM</option>
                    <option value="M. MOVEL">M. MOVEL</option>
                    <option value="M. FIXA">M. FIXA</option>
                    <option value="M. EL������TRICA">M. ELÉTRICA</option>
                    <option value="PRODUÇÃO">PRODUÇÃO</option>
                    <option value="MINA">MINA</option>
                  </select>
                </div>
                
                <!-- 5. Data -->
                <div>
                  <label for="func-rid-data" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">5. Data</label>
                  <input id="func-rid-data" type="date" required style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};" />
                </div>
                
                <!-- 6. Incidente ou Desvios -->
                <div>
                  <label for="func-rid-incidente" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">6. Incidente ou Desvios</label>
                  <select id="func-rid-incidente" required style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};">
                    <option value="">Selecione...</option>
                    <option value="Condição de Risco">Condição de Risco</option>
                    <option value="Desvio Comportamental">Desvio Comportamental</option>
                    <option value="Dano Material">Dano Material</option>
                    <option value="Quase acidente">Quase acidente</option>
                  </select>
                </div>
                
                <!-- 7. Origem da detecção -->
                <div>
                  <label for="func-rid-origem" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">7. Origem da detecção</label>
                  <select id="func-rid-origem" required style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};">
                    <option value="">Selecione...</option>
                    <option value="CSL">CSL</option>
                    <option value="Inspeção programada">Inspeção programada</option>
                    <option value="Inspeção não programada">Inspeção não programada</option>
                    <option value="Observação Comportamental">Observação Comportamental</option>
                    <option value="Constatação espontânea">Constatação espontânea</option>
                    <option value="Auditoria">Auditoria</option>
                  </select>
                </div>
                
                <!-- 8. Local da ocorrência -->
                <div>
                  <label for="func-rid-local" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">8. Local da ocorrência</label>
                  <input id="func-rid-local" type="text" required placeholder="Insira o local da ocorrência" style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};" />
                </div>
                
                <!-- 9. Descrição da Ocorrência -->
                <div>
                  <label for="func-rid-descricao" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">9. Descrição da Ocorrência</label>
                  <textarea id="func-rid-descricao" required rows="4" placeholder="Descreva detalhadamente a ocorrência" style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; resize: vertical; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};"></textarea>
                </div>
                
                <!-- 10. Classificação de risco -->
                <div>
                  <label for="func-rid-risco" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">10. Classificação de risco</label>
                  <div style="font-size: 11px; opacity: 0.7; margin-bottom: 8px; line-height: 1.4; color: ${config.text_color || defaultConfig.text_color};">
                    <strong>Baixo:</strong> Situações com baixo potencial de causar acidente.<br>
                    <strong>Médio:</strong> Situações que podem causar acidente leve se não forem corrigidas.<br>
                    <strong>Alto:</strong> Situações com alto potencial de causar acidente grave ou incapacitante.<br>
                    <strong>Crítico:</strong> Situações com risco iminente de acidente grave ou fatal.
                  </div>
                  <select id="func-rid-risco" required style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};">
                    <option value="">Selecione...</option>
                    <option value="Baixo">Baixo</option>
                    <option value="Médio">Médio</option>
                    <option value="Alto">Alto</option>
                    <option value="Crítico">Crítico</option>
                  </select>
                </div>
                
                <!-- 11. Ação Imediata -->
                <div>
                  <label for="func-rid-acao" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">11. Ação Imediata</label>
                  <textarea id="func-rid-acao" required rows="3" placeholder="Descreva a ação imediata tomada" style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; resize: vertical; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};"></textarea>
                </div>
                
                <!-- 12. Status -->
                <div>
                  <label for="func-rid-status" style="display: block; margin-bottom: 6px; font-size: 13px; font-weight: 500; color: ${config.text_color || defaultConfig.text_color};">12. Status</label>
                  <div style="font-size: 11px; opacity: 0.7; margin-bottom: 8px; line-height: 1.4; color: ${config.text_color || defaultConfig.text_color};">
                    <strong>Corrigido:</strong> RID que já foi resolvido.<br>
                    <strong>Vencido:</strong> RID pendente que vai ser passado para um encarregado resolver.
                  </div>
                  <select id="func-rid-status" required style="width: 100%; padding: 10px 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; border-radius: 8px; font-size: 14px; background: ${config.surface_color || defaultConfig.surface_color}; color: ${config.text_color || defaultConfig.text_color};">
                    <option value="">Selecione...</option>
                    <option value="Corrigidos">CORRIGIDO</option>
                    <option value="Vencidos">VENCIDO</option>
                  </select>
                </div>
                
                <div style="display: flex; gap: 12px; margin-top: 8px;">
                  <button type="button" id="btn-cancelar-func-rid" style="flex: 1; padding: 12px; border: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}40; background: none; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer; color: ${config.text_color || defaultConfig.text_color};">
                    Cancelar
                  </button>
                  <button type="submit" id="btn-func-salvar-rid" style="flex: 1; padding: 12px; border: none; background: ${config.primary_action_color || defaultConfig.primary_action_color}; color: #fff; border-radius: 8px; font-size: 14px; font-weight: 600; cursor: pointer;">
                    <span id="btn-func-salvar-text">Registrar RID</span>
                  </button>
                </div>
              </form>
            </div>
          </div>
        </div>
      `;
      
      applyConfigToFuncPanel(config);
      attachFuncListeners();
      renderFuncRidsList();
    }
    
    function attachFuncListeners() {
      const btnLogout = $('btn-func-logout');
      if (btnLogout) {
        btnLogout.addEventListener('click', () => {
          currentUser = null;
          showMessage('Logout realizado com sucesso', 'info');
          render();
        });
      }
      
      const btnAbrirModal = $('btn-abrir-modal-rid');
      const modal = $('modal-func-novo-rid');
      const btnCancelar = $('btn-cancelar-func-rid');
      const form = $('form-func-rid');
      
      if (btnAbrirModal && modal) {
        btnAbrirModal.addEventListener('click', () => {
          if (currentRecordCount >= 999) {
            showMessage('Limite máximo de 999 RIDs atingido', 'error');
            return;
          }
          modal.style.display = 'flex';
        });
      }
      
      if (btnCancelar && modal && form) {
        btnCancelar.addEventListener('click', () => {
          modal.style.display = 'none';
          form.reset();
        });
      }
      
      if (modal) {
        modal.addEventListener('click', (e) => {
          if (e.target === modal && form) {
            modal.style.display = 'none';
            form.reset();
          }
        });
      }
      
      if (form) {
        form.addEventListener('submit', async (e) => {
          e.preventDefault();
          
          if (!window.dataSdk) {
            showMessage('Sistema de dados não disponível', 'error');
            return;
          }
          
          if (currentRecordCount >= 999) {
            showMessage('Limite máximo de 999 RIDs atingido', 'error');
            return;
          }
          
          const emitente = $('func-rid-emitente').value.trim();
          const tipoContrato = $('func-rid-tipo-contrato').value;
          const unidade = $('func-rid-unidade').value.trim();
          const setor = $('func-rid-setor').value;
          const data = $('func-rid-data').value;
          const incidente = $('func-rid-incidente').value;
          const origem = $('func-rid-origem').value;
          const local = $('func-rid-local').value.trim();
          const descricao = $('func-rid-descricao').value.trim();
          const risco = $('func-rid-risco').value;
          const acao = $('func-rid-acao').value.trim();
          const status = $('func-rid-status').value;
          
          if (!emitente || !tipoContrato || !unidade || !setor || !data || !incidente || !origem || !local || !descricao || !risco || !acao || !status) {
            showMessage('Preencha todos os campos obrigatórios', 'error');
            return;
          }
          
          const btnSalvar = $('btn-func-salvar-rid');
          const btnText = $('btn-func-salvar-text');
          if (btnSalvar && btnText) {
            btnSalvar.disabled = true;
            btnText.innerHTML = '<div class="spinner"></div>';
          }
          
          const now = new Date().toISOString();
          const record = {
            tipo_usuario: 'funcionario',
            nome_funcionario: currentUser.nome,
            emitente: emitente,
            tipo_contrato: tipoContrato,
            unidade: unidade,
            setor: setor,
            data_ocorrencia: data,
            incidente: incidente,
            origem_deteccao: origem,
            local_ocorrencia: local,
            titulo: `${incidente} - ${local}`,
            descricao: descricao,
            classificacao_risco: risco,
            acao_imediata: acao,
            status: status,
            data_criacao: now,
            ultimo_update: now
          };
          
          const result = await window.dataSdk.create(record);
          
          if (btnSalvar && btnText) {
            btnSalvar.disabled = false;
            btnText.textContent = 'Registrar RID';
          }
          
          if (result.isOk) {
            showMessage('RID registrado com sucesso!', 'success');
            if (modal) modal.style.display = 'none';
            form.reset();
          } else {
            showMessage('Erro ao registrar RID', 'error');
          }
        });
      }
    }
    
    function renderFuncRidsList() {
      const container = $('func-rids-list');
      if (!container) return;
      
      const config = window.elementSdk?.config || defaultConfig;
      
      // Filtrar apenas RIDs do funcionário logado (excluir usuários cadastrados)
      const meusRids = currentData
        .filter(r => r.tipo_usuario === 'funcionario' && r.nome_funcionario === currentUser.nome)
        .sort((a, b) => new Date(b.data_criacao).getTime() - new Date(a.data_criacao).getTime());
      
      if (meusRids.length === 0) {
        container.innerHTML = `
          <div style="padding: 40px; text-align: center;">
            <p style="margin: 0; opacity: 0.6; font-size: 14px; color: ${config.text_color || defaultConfig.text_color};">Você ainda não possui RIDs registrados</p>
          </div>
        `;
        return;
      }
      
      container.innerHTML = meusRids.map(r => `
        <div style="padding: 16px; border-bottom: 1px solid ${config.secondary_action_color || defaultConfig.secondary_action_color}20;">
          <div style="display: flex; align-items: start; justify-content: space-between; gap: 16px;">
            <div style="flex: 1;">
              <h3 style="margin: 0 0 8px 0; font-size: 15px; font-weight: 600; color: ${config.text_color || defaultConfig.text_color};">${r.titulo}</h3>
              <p style="margin: 0 0 12px 0; font-size: 13px; opacity: 0.7; line-height: 1.5; color: ${config.text_color || defaultConfig.text_color};">${r.descricao}</p>
              <div style="font-size: 12px; opacity: 0.6; color: ${config.text_color || defaultConfig.text_color};">
                Criado em: ${new Date(r.data_criacao).toLocaleDateString()} ${new Date(r.data_criacao).toLocaleTimeString()}
              </div>
            </div>
            <span style="padding: 6px 12px; background: ${getStatusColor(r.status, config)}20; color: ${getStatusColor(r.status, config)}; border-radius: 6px; font-size: 12px; font-weight: 500; white-space: nowrap;">
              ${r.status}
            </span>
          </div>
        </div>
      `).join('');
    }
    
    // ============================================
    // APLICAR CONFIG (Element SDK)
    // ============================================
    function applyConfigToLogin(config) {
      const cfg = config || defaultConfig;
      
      const title = $('login-title');
      if (title) {
        title.textContent = cfg.titulo_sistema || defaultConfig.titulo_sistema;
        title.style.fontSize = (cfg.font_size || defaultConfig.font_size) * 1.6 + 'px';
        title.style.fontFamily = `${cfg.font_family || defaultConfig.font_family}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;
      }
      
      const subtitle = $('login-subtitle');
      if (subtitle) {
        subtitle.textContent = cfg.texto_login || defaultConfig.texto_login;
        subtitle.style.fontSize = (cfg.font_size || defaultConfig.font_size) * 0.93 + 'px';
      }
      
      const demoUser = $('demo-admin-user');
      const demoPass = $('demo-admin-pass');
      if (demoUser) demoUser.textContent = cfg.usuario_admin || defaultConfig.usuario_admin;
      if (demoPass) demoPass.textContent = cfg.senha_admin || defaultConfig.senha_admin;
    }
    
    function applyConfigToAdminPanel(config) {
      const cfg = config || defaultConfig;
      
      const sidebarTitle = $('admin-sidebar-title');
      if (sidebarTitle) {
        sidebarTitle.textContent = cfg.titulo_sistema || defaultConfig.titulo_sistema;
        sidebarTitle.style.fontFamily = `${cfg.font_family || defaultConfig.font_family}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;
      }
    }
    
    function applyConfigToFuncPanel(config) {
      const cfg = config || defaultConfig;
      
      const title = $('func-panel-title');
      if (title) {
        title.textContent = cfg.titulo_sistema || defaultConfig.titulo_sistema;
        title.style.fontFamily = `${cfg.font_family || defaultConfig.font_family}, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif`;
      }
    }
    
    async function onConfigChange(config) {
      const cfg = config || defaultConfig;
      
      if (!currentUser) {
        applyConfigToLogin(cfg);
      } else if (currentUser.tipo === 'admin') {
        applyConfigToAdminPanel(cfg);
        renderAdminSection();
      } else {
        applyConfigToFuncPanel(cfg);
        renderFuncRidsList();
      }
    }
    
    // ============================================
    // ELEMENT SDK
    // ============================================
    function initElementSdk() {
      if (!window.elementSdk) {
        render();
        initDataSdk();
        return;
      }
      
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => {
          const cfg = config || defaultConfig;
          return {
            recolorables: [
              {
                get: () => cfg.background_color || defaultConfig.background_color,
                set: (value) => {
                  window.elementSdk.setConfig({ background_color: value });
                }
              },
              {
                get: () => cfg.surface_color || defaultConfig.surface_color,
                set: (value) => {
                  window.elementSdk.setConfig({ surface_color: value });
                }
              },
              {
                get: () => cfg.text_color || defaultConfig.text_color,
                set: (value) => {
                  window.elementSdk.setConfig({ text_color: value });
                }
              },
              {
                get: () => cfg.primary_action_color || defaultConfig.primary_action_color,
                set: (value) => {
                  window.elementSdk.setConfig({ primary_action_color: value });
                }
              },
              {
                get: () => cfg.secondary_action_color || defaultConfig.secondary_action_color,
                set: (value) => {
                  window.elementSdk.setConfig({ secondary_action_color: value });
                }
              }
            ],
            borderables: [],
            fontEditable: {
              get: () => cfg.font_family || defaultConfig.font_family,
              set: (value) => {
                window.elementSdk.setConfig({ font_family: value });
              }
            },
            fontSizeable: {
              get: () => cfg.font_size || defaultConfig.font_size,
              set: (value) => {
                window.elementSdk.setConfig({ font_size: value });
              }
            }
          };
        },
        mapToEditPanelValues: (config) => {
          const cfg = config || defaultConfig;
          return new Map([
            ['titulo_sistema', cfg.titulo_sistema || defaultConfig.titulo_sistema],
            ['texto_login', cfg.texto_login || defaultConfig.texto_login],
            ['usuario_admin', cfg.usuario_admin || defaultConfig.usuario_admin],
            ['senha_admin', cfg.senha_admin || defaultConfig.senha_admin]
          ]);
        }
      });
      
      render();
      initDataSdk();
    }
    
    // ============================================
    // DATA SDK
    // ============================================
    function initDataSdk() {
      if (!window.dataSdk) return;
      
      const handler = {
        onDataChanged: (data) => {
          currentData = data || [];
          currentRecordCount = currentData.length;
          
          if (currentUser) {
            if (currentUser.tipo === 'admin') {
              if (currentAdminSection === 'dashboard') {
                const dashContent = $('admin-content');
                if (dashContent) {
                  renderDashboard(dashContent);
                }
              } else if (currentAdminSection === 'rids') {
                renderRidsList();
              } else if (currentAdminSection === 'funcionarios') {
                renderFuncionariosSection($('admin-content'));
              }
            } else {
              renderFuncRidsList();
            }
          }
        }
      };
      
      (async () => {
        const result = await window.dataSdk.init(handler);
        if (!result.isOk) {
          showMessage('Erro ao conectar com o sistema de dados', 'error');
          return;
        }
        
        // Adicionar dados de exemplo apenas se o banco estiver vazio
        if (currentData.length === 0) {
          await adicionarDadosExemplo();
        }
      })();
    }
    
    // ============================================
    // DADOS DE EXEMPLO
    // ============================================
    async function adicionarDadosExemplo() {
      if (!window.dataSdk) return;
      
      const funcionarios = [
        'Carlos Silva',
        'Ana Santos',
        'Pedro Oliveira',
        'Maria Costa',
        'João Ferreira'
      ];
      
      const ridsExemplo = [
        {
          nome_funcionario: 'Carlos Silva',
          titulo: 'Falha no sistema de refrigeração',
          descricao: 'A máquina de produção linha 3 apresentou superaquecimento devido a falha no sistema de refrigeração. Necessário manutenção urgente.',
          status: 'Em aberto'
        },
        {
          nome_funcionario: 'Carlos Silva',
          titulo: 'Vazamento de óleo hidráulico',
          descricao: 'Detectado vazamento de óleo na prensa hidr��ulica do setor B. Risco de contamina��ão ambiental.',
          status: 'Vencidos'
        },
        {
          nome_funcionario: 'Ana Santos',
          titulo: 'Equipamento de proteção danificado',
          descricao: 'Luvas de proteção térmica apresentam rasgos e não oferecem proteção adequada. Solicito substituição imediata.',
          status: 'Corrigidos'
        },
        {
          nome_funcionario: 'Ana Santos',
          titulo: 'Iluminação inadequada no setor',
          descricao: 'Três lâmpadas queimadas no corredor principal do setor de montagem, prejudicando a visibilidade e segurança.',
          status: 'Em aberto'
        },
        {
          nome_funcionario: 'Ana Santos',
          titulo: 'Ruído excessivo na área de corte',
          descricao: 'Nível de ruído acima do permitido na área de corte. Necessário avaliação e implementação de medidas de controle.',
          status: 'Vencidos'
        },
        {
          nome_funcionario: 'Pedro Oliveira',
          titulo: 'Piso escorregadio na entrada',
          descricao: 'Piso molhado sem sinalização adequada na entrada do vestiário. Risco de quedas.',
          status: 'Corrigidos'
        },
        {
          nome_funcionario: 'Pedro Oliveira',
          titulo: 'Extintor de incêndio vencido',
          descricao: 'Extintor localizado próximo ao almoxarifado está com prazo de validade vencido há 2 meses.',
          status: 'Em aberto'
        },
        {
          nome_funcionario: 'Maria Costa',
          titulo: 'Falta de sinalização de emergência',
          descricao: 'Placas de saída de emergência apagadas no segundo andar. Necessário substituição urgente.',
          status: 'Vencidos'
        },
        {
          nome_funcionario: 'Maria Costa',
          titulo: 'Cadeira ergon��mica com defeito',
          descricao: 'Cadeira do posto de trabalho 15 com regulagem de altura quebrada, causando desconforto e má postura.',
          status: 'Corrigidos'
        },
        {
          nome_funcionario: 'João Ferreira',
          titulo: 'Ferramenta manual danificada',
          descricao: 'Chave inglesa com cabo solto representando risco de acidente. Ferramenta deve ser substituída.',
          status: 'Em aberto'
        },
        {
          nome_funcionario: 'João Ferreira',
          titulo: 'Falta de kit de primeiros socorros',
          descricao: 'Kit de primeiros socorros do setor de embalagem está incompleto, faltando itens essenciais como ataduras e antisséptico.',
          status: 'Vencidos'
        },
        {
          nome_funcionario: 'Carlos Silva',
          titulo: 'Proteção de máquina removida',
          descricao: 'Proteção lateral da serra circular foi removida e não recolocada. Risco grave de acidente.',
          status: 'Corrigidos'
        }
      ];
      
      // Criar RIDs com datas variadas
      const agora = new Date();
      for (let i = 0; i < ridsExemplo.length; i++) {
        const rid = ridsExemplo[i];
        const diasAtras = Math.floor(Math.random() * 30); // Entre 0 e 30 dias atrás
        const dataCriacao = new Date(agora);
        dataCriacao.setDate(dataCriacao.getDate() - diasAtras);
        
        const record = {
          tipo_usuario: 'funcionario',
          nome_funcionario: rid.nome_funcionario,
          titulo: rid.titulo,
          descricao: rid.descricao,
          status: rid.status,
          data_criacao: dataCriacao.toISOString(),
          ultimo_update: dataCriacao.toISOString()
        };
        
        await window.dataSdk.create(record);
        
        // Pequeno delay para não sobrecarregar
        await new Promise(resolve => setTimeout(resolve, 100));
      }
      
      console.log('������ Dados de exemplo adicionados com sucesso!');
      showMessage('Dados de exemplo carregados!', 'success');
    }
    
    // ============================================
    // BOOTSTRAP
    // ============================================
    initElementSdk();
  </script>
 <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9a4581698181f1dd',t:'MTc2NDExOTQyMC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script></body>
</html>